<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arka Elektronike</title>
    <!-- Link to the single, consolidated stylesheet -->
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="print.css" media="print">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react/": "https://esm.sh/react@^19.1.0/",
    "path": "https://esm.sh/path@^0.12.7",
    "url": "https://esm.sh/url@^0.11.4",
    "vite": "https://esm.sh/vite@^7.0.0"
  }
}
</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="/index.css">
  <link rel="stylesheet" href="styles/theme.css">
  <link rel="stylesheet" href="styles/theme-overrides.css">
</head>
<body>
    <div id="auth-view">
        <div class="login-wrapper">
            <div class="login-showcase">
                <div id="login-logo-container">
                    <img id="login-logo-image" src="#" alt="Logo e Aplikacionit">
                </div>
                <div class="showcase-overlay">
                    <h2 class="showcase-title"><span id="showcase-title-prefix">Mir√´ se vini n√´</span> <span id="showcase-app-name">Arka Elektronike</span></h2>
                    <p class="showcase-subtitle" id="showcase-subtitle-text">Zgjidhja juaj e plot√´ p√´r menaxhimin e biznesit.</p>
                </div>
            </div>
            <div class="login-content">
                <div class="login-header">
                    <h3>Hyni n√´ Llogarin√´ Tuaj</h3>
                </div>
                <div id="login-form-container">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-username">P√´rdoruesi:</label>
                            <div class="input-group">
                                <span class="input-group-icon" aria-hidden="true">üë§</span>
                                <input type="text" id="login-username" name="username" required placeholder="Emri i p√´rdoruesit">
                            </div>
                        </div>
                        <div class="form-group" id="login-business-group" style="display: none;">
                            <label for="login-business-select">Zgjidh Biznesin:</label>
                             <div class="input-group">
                                <span class="input-group-icon select-icon" aria-hidden="true">üè¢</span>
                                <select id="login-business-select" name="businessId" class="form-control">
                                    <option value="">-- Zgjidh Biznesin --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Fjal√´kalimi:</label>
                            <div class="input-group">
                                <span class="input-group-icon" aria-hidden="true">üîí</span>
                                <input type="password" id="login-password" name="password" required placeholder="Fjal√´kalimi">
                            </div>
                        </div>
                        <p id="login-error" class="error-message" aria-live="polite"></p>
                        <button type="submit" class="btn btn-primary btn-block">Hyr</button>
                        <button type="button" id="admin-login-shortcut-btn" class="btn btn-secondary btn-block">Ky√ßu si Admin</button>
                    </form>
                </div>
                <div id="open-shifts-info-container" style="display: none;">
                    <!-- Informacioni p√´r nd√´rrimet e hapura do t√´ shfaqet k√´tu -->
                </div>
            </div>
        </div>
    </div>

    <div id="app-root" style="display: none;">
        <header class="app-header">
            <h1><span id="app-title-text">Arka Elektronike</span></h1>
            <div class="header-right-group">
                <div id="seller-cash-status-container" class="seller-cash-status-header" style="display: none;">
                    <div class="cash-status-grid-header">
                        <p>Arka Fill.: <span id="seller-initial-cash">N/A</span> ‚Ç¨</p>
                        <p>Shitjet: <span id="seller-total-sales-cash">0.00</span> ‚Ç¨</p>
                        <p>Gjendja: <span id="seller-current-cash">N/A</span> ‚Ç¨</p>
                    </div>
                    <p id="seller-day-status-message" class="info-message header-status-message" style="display:none;"></p>
                </div>
                <div id="user-session-controls">
                     <span id="user-greeting"></span>
                     <button id="logout-btn" class="btn btn-danger">Dilni</button>
                </div>
            </div>
        </header>
        <main class="app-main">
            <!-- Seller Point of Sale View -->
            <div id="seller-pos-view" style="display: none;">
                <div id="seller-workspace">
                    <section id="product-catalog-section" class="pos-section workspace-section" aria-labelledby="product-catalog-heading">
                        <h2 id="product-catalog-heading" class="pos-section-title">Katalogu i Produkteve & Ofertave</h2>
                        <div class="product-search-container">
                            <span class="search-icon" aria-hidden="true">üîç</span>
                            <input type="search" id="product-search-input" placeholder="K√´rko Produktin ose Ofert√´n...">
                        </div>
                        <div class="table-responsive">
                            <table id="product-table" class="pos-table">
                                <thead>
                                    <tr>
                                        <th>Produkti/Oferta</th>
                                        <th>√ámimi (‚Ç¨)</th>
                                        <th>Stoku/Info</th>
                                        <th>Veprim</th>
                                    </tr>
                                </thead>
                                <tbody id="product-table-body">
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section id="current-sale-section" class="pos-section workspace-section" aria-labelledby="current-sale-heading">
                        <div class="current-sale-header-controls">
                            <h2 id="current-sale-heading" class="pos-section-title">Shitja Aktuale</h2>
                            <div id="seller-customer-selection-group" class="form-group custom-select-wrapper">
                                <input type="text" id="customer-search-input" class="form-control" placeholder="K√´rko Bler√´sin...">
                                <div id="customer-dropdown-panel" class="custom-dropdown-panel" style="display: none;">
                                    <!-- Customer items will be populated here by JS -->
                                </div>
                            </div>
                            <div class="sale-actions">
                                <button id="seller-view-shift-sales-btn" class="btn btn-info">Shitjet e Nd√´rrimit</button>
                                <button id="record-petty-cash-btn" class="btn btn-secondary">Regjistro Shpenzim</button>
                                <button id="clear-sale-btn" class="btn btn-warning">Pastro Shitjen</button>
                            </div>
                        </div>
                        <div id="sale-items-list" class="sale-items-list">
                             <p class="empty-sale-message">Asnj√´ produkt n√´ shitje.</p>
                        </div>
                        <div class="sale-summary">
                            <div class="summary-row">
                                <span>N√´ntotali:</span>
                                <span id="subtotal">0.00 ‚Ç¨</span>
                            </div>
                            <div class="summary-row total-row">
                                <span><strong>Totali:</strong></span>
                                <span id="grand-total"><strong>0.00 ‚Ç¨</strong></span>
                            </div>
                            <div class="complete-sale-action-row">
                                <button id="trigger-complete-sale-btn" class="btn btn-success btn-block">P√´rfundo Shitjen</button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

           <!-- Manager Dashboard View - New Layout with Sidebar & Tabs -->
            <div id="manager-dashboard-view" style="display: none;">
                <nav id="manager-sidebar">
                    <div id="manager-sidebar-user-greeting" style="display: none;"></div>
                    <div class="manager-sidebar-header">
                        <h3 id="manager-sidebar-title">Paneli i Menaxherit</h3>
                    </div>
                    <div class="manager-sidebar-search-container">
                        <input type="search" id="manager-sidebar-search" placeholder="K√´rko n√´ Menu..." aria-label="K√´rko n√´ menyn√´ e menaxherit">
                    </div>
                    <ul id="dynamic-manager-menu-container" class="manager-sidebar-nav accordion-menu">
                        <!-- Manager menu items will be dynamically populated here by JS -->
                        <p class="loading-message" style="color: #fff; padding: 1rem;">Duke ngarkuar menun√´...</p>
                    </ul>
                    <div id="manager-sidebar-logout-container" style="display: none;"></div>
                </nav>

                <div id="manager-main-content">
                    <div id="manager-tab-navigation">
                        <!-- Tab buttons will be dynamically populated here -->
                    </div>
                    <div id="manager-tab-content-area">
                        <!-- Default Dashboard/Summary View -->
                        <div id="manager-content-dashboard" class="manager-content-section">
                            <h2 class="manager-section-title">P√´rmbledhje & Njoftime</h2>
                            <div class="dashboard-widgets-grid">
                                <div class="widget-card" id="widget-today-sales">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Shitjet e Sotme (Total)</h4>
                                    </div>
                                    <p class="large-stat" id="dashboard-today-sales-total">0.00 ‚Ç¨</p>
                                    <p id="dashboard-today-sales-count">0 Fatura</p>
                                    <div class="chart-container small-chart-container">
                                        <canvas id="today-sales-trend-chart"></canvas>
                                    </div>
                                </div>

                                <div class="widget-card" id="widget-top-product">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Artikulli m√´ i Shituri Sot</h4>
                                    </div>
                                    <p>Produkti: <strong id="dash-top-product-name">N/A</strong></p>
                                    <p>Sasia: <strong id="dash-top-product-quantity">0</strong></p>
                                    <p class="large-stat" id="dash-top-product-revenue">0.00 ‚Ç¨</p>
                                </div>

                                <div class="widget-card" id="widget-top-customer">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Bler√´si m√´ Aktiv Sot</h4>
                                    </div>
                                    <p>Emri: <strong id="dash-top-customer-name">N/A</strong></p>
                                    <p class="widget-label">Shpenzuar:</p>
                                    <p class="large-stat" id="dash-top-customer-spent">0.00 ‚Ç¨</p>
                                </div>
                                
                                <div class="widget-card" id="widget-top-seller">
                                    <div class="widget-card-header">
                                         <span class="widget-icon"></span>
                                        <h4>Shit√´si m√´ Performues Sot</h4>
                                    </div>
                                    <p>P√´rdoruesi: <strong id="dash-top-seller-name">N/A</strong></p>
                                     <p class="widget-label">Vlera e Shitjeve:</p>
                                    <p class="large-stat" id="dash-top-seller-sales">0.00 ‚Ç¨</p>
                                </div>

                                <div class="widget-card" id="widget-subscription-status">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Statusi i Abonimit</h4>
                                    </div>
                                    <div id="dashboard-subscription-status">
                                         <p>Paketa: <strong id="dash-sub-package-name">N/A</strong></p>
                                         <p>Skadenca: <strong id="dash-sub-expiry-date">N/A</strong></p>
                                         <p>Statusi: <strong id="dash-sub-status" class="status-badge">N/A</strong></p>
                                    </div>
                                </div>

                                 <div class="widget-card" id="widget-open-shifts">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Arkat e Hapura (<span id="dash-open-shifts-count">0</span>)</h4>
                                    </div>
                                    <div id="dashboard-open-shifts-summary" class="widget-scrollable-content">
                                        <p>Duke ngarkuar...</p>
                                    </div>
                                </div>
                                
                                <div class="widget-card" id="widget-gemini-analysis">
                                    <div class="widget-card-header">
                                        <span class="widget-icon">üß†</span>
                                        <h4>Analiza e Dit√´s nga Gemini</h4>
                                    </div>
                                    <div id="gemini-analysis-content" class="widget-scrollable-content">
                                        <p class="gemini-placeholder-text">Kliko butonin m√´ posht√´ p√´r t√´ marr√´ nj√´ analiz√´ t√´ dit√´s nga inteligjenca artificiale.</p>
                                        <div id="gemini-analysis-output"></div>
                                        <div id="gemini-analysis-loader" style="display: none; text-align: center; padding: 1rem;">
                                            <div class="spinner"></div>
                                            <p>Duke analizuar t√´ dh√´nat...</p>
                                        </div>
                                        <p id="gemini-analysis-error" class="error-message" style="display: none;"></p>
                                    </div>
                                    <div class="widget-card-footer">
                                        <button id="generate-gemini-analysis-btn" class="btn btn-primary btn-sm btn-block">Gjenero Analiz√´n</button>
                                    </div>
                                </div>
                                
                                <div class="widget-card" id="widget-overall-sales">
                                    <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Shitjet Totale (P√´rgjithshme)</h4>
                                    </div>
                                    <p class="large-stat" id="dashboard-overall-sales-total">0.00 ‚Ç¨</p>
                                    <p id="dashboard-overall-sales-count">0 Fatura</p>
                                    <div id="overall-sales-chart-placeholder" class="chart-container">
                                        <canvas id="overall-sales-chart"></canvas>
                                    </div>
                                </div>

                                <div class="widget-card" id="widget-overall-purchases">
                                     <div class="widget-card-header">
                                        <span class="widget-icon"></span>
                                        <h4>Blerjet Totale Vendore</h4>
                                    </div>
                                    <p class="large-stat" id="dashboard-overall-purchases-total">0.00 ‚Ç¨</p>
                                    <p id="dashboard-overall-purchases-count">0 Fatura</p>
                                    <div id="overall-purchases-chart-placeholder" class="chart-container">
                                         <canvas id="overall-purchases-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Actions View -->
                        <div id="manager-content-actions" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Veprimet Kryesore</h2>
                            <div class="actions-grid-container">
                                <button id="start-day-btn" class="btn btn-secondary action-grid-button">
                                    <span class="icon">‚òÄÔ∏è</span> Hap Ark√´n Ditore P√´r Shit√´s
                                </button>
                                <button id="edit-open-cash-entry-btn" class="btn btn-warning action-grid-button">
                                    <span class="icon">‚úèÔ∏è</span> Modifiko Ark√´n e Hapur
                                </button>
                                <button id="reconcile-day-btn" class="btn btn-info action-grid-button">
                                    <span class="icon">‚öñÔ∏è</span> Mbyll &amp; Barazo Ark√´n
                                </button>
                                <button id="change-clear-sale-pin-btn" class="btn btn-secondary action-grid-button">
                                    <span class="icon">üîë</span> Ndrysho PIN-in e Pastrimit
                                </button>
                            </div>
                        </div>

                        <!-- Today's Sales View (New) -->
                        <div id="manager-content-todays_sales" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Shitjet e Sotme</h2>
                            <div class="filter-container product-search-container">
                                <span class="search-icon" aria-hidden="true">üîç</span>
                                <input type="search" id="todays-sales-filter-input" placeholder="K√´rko (sipas Nr. Fatur√´s, Bler√´sit, Shit√´sit)..." class="form-control">
                            </div>
                            <div class="table-container" id="todays-sales-table-container">
                                <table id="todays-sales-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>Ora</th>
                                            <th>Nr. Fatur√´s</th>
                                            <th>Shit√´si</th>
                                            <th>Nd√´rrimi</th>
                                            <th>Bler√´si</th>
                                            <th>Artikujt</th>
                                            <th class="text-right">Totali (‚Ç¨)</th>
                                            <th>Veprime</th>
                                        </tr>
                                    </thead>
                                    <tbody id="todays-sales-tbody">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="todays-sales-summary" class="report-summary" style="margin-top: 1rem;">
                                <!-- Summary like total sales for today will be populated here by JS -->
                            </div>
                        </div>
                         <!-- Local Sales Management View (New) -->
                        <div id="manager-content-local_sales_management" class="manager-content-section" style="display:none;">
                            <!-- Content for local sales management will be populated by JS -->
                        </div>
                        <!-- Add Local Sale Form View (New) -->
                        <div id="manager-content-add_local_sale" class="manager-content-section purchase-form-section" style="display:none;">
                            <!-- Content for adding/editing local sale will be populated by JS -->
                        </div>
                        
                        <!-- Sales Returns List View (Updated) -->
                        <div id="manager-content-sales_returns_list" class="manager-content-section admin-panel" style="display:none;">
                            <div class="admin-panel-header">
                                <h2 class="manager-section-title">Kthimet e Shitjeve</h2>
                                <div class="admin-panel-actions">
                                    <button id="btn-add-new-sales-return" class="btn btn-primary">
                                        <span class="icon">‚ûï</span> Shto Kthim t√´ Ri Shitjeje
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="sales-returns-list-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>ID Kthimi</th>
                                            <th>Data Kthimit</th>
                                            <th>Nr. Fatur√´s Origjinale</th>
                                            <th>Bler√´si</th>
                                            <th class="text-right">Vlera Totale e Kthimit (‚Ç¨)</th>
                                            <th>Veprime</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sales-returns-list-tbody">
                                        <tr><td colspan="6" class="text-center">Nuk ka kthime shitjesh t√´ regjistruara.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Add/Edit Sales Return Form View (MODIFIED) -->
                        <div id="manager-content-add_sales_return" class="manager-content-section purchase-form-section" style="display:none;">
                            <h2 id="sales-return-form-title" class="manager-section-title">Shto Kthim t√´ Ri Shitjeje</h2>
                            <form id="sales-return-form">
                                <input type="hidden" id="edit-sales-return-id" name="editSalesReturnId">
                                
                                <div class="modal-section"> 
                                    <div class="form-grid-2-cols"> <!-- Changed from 3-cols to 2-cols for better layout -->
                                        <div class="form-group">
                                            <label for="sr-customer-search-input">K√´rko Bler√´sin:</label>
                                            <div class="custom-select-wrapper"> <!-- Wrapper for positioning dropdown -->
                                                <input type="text" id="sr-customer-search-input" name="customerSearch" placeholder="K√´rko Bler√´sin (Emri, Kodi)..." class="form-control">
                                                <div id="sr-customer-dropdown-panel" class="custom-dropdown-panel" style="display: none;">
                                                    <!-- Customer suggestions will be populated here by JS -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="sr-return-date">Data e Kthimit:</label>
                                            <input type="date" id="sr-return-date" name="returnDate" required class="form-control">
                                        </div>
                                    </div>
                                     <div class="form-group" style="max-width: 33%; margin-top: 0.5rem;"> <!-- System invoice number, can be in its own row or styled -->
                                        <label for="sr-system-invoice-number">Nr. Fatur√´s Kthimit (Sistem):</label>
                                        <input type="text" id="sr-system-invoice-number" name="systemReturnInvoiceNumber" readonly class="readonly-field form-control">
                                    </div>

                                    <!-- Container to display sales for selected customer -->
                                    <div id="sr-customer-sales-list-container" style="margin-top: 1rem; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 0.5rem; display:none;">
                                        <h4 style="margin-top:0; margin-bottom:0.5rem; font-size:1.1rem; color:#555;">Shitjet p√´r Bler√´sin e Zgjedhur:</h4>
                                        <!-- Sales list will be populated here by JS -->
                                        <p class="info-message secondary text-center">Zgjidhni nj√´ bler√´s p√´r t√´ par√´ historikun e shitjeve.</p>
                                    </div>

                                    <div id="sr-original-sale-details" class="info-message secondary" style="display:none; margin-top: 1rem; text-align: left;">
                                        <!-- Original sale details will be shown here by JS after a sale is selected -->
                                    </div>
                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label for="sr-reason">Arsyeja e Kthimit (Opsionale):</label>
                                        <input type="text" id="sr-reason" name="reason" class="form-control">
                                    </div>
                                </div>

                                <hr class="modal-divider">
                                
                                <div class="modal-section">
                                    <h3 class="modal-section-title">Artikujt nga Fatura Origjinale e Zgjedhur (P√´r Kthim)</h3>
                                    <div class="table-responsive" style="max-height: 250px;">
                                        <table class="admin-table items-table" id="sr-original-sale-items-table">
                                            <thead>
                                                <tr>
                                                    <th>Produkti</th>
                                                    <th class="text-right">Sasia Origj.</th>
                                                    <th style="width: 120px;">Sasia P√´r Kthim</th>
                                                    <th class="text-right">√ámimi Kthimit (pa TVSH)</th>
                                                    <th class="text-right">TVSH (%)</th>
                                                    <th class="text-right">√ámimi Kthimit (me TVSH)</th>
                                                    <th class="text-right">Vlera Tot. Kthimit</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sr-items-to-return-tbody">
                                                <tr><td colspan="7" class="text-center">Zgjidhni nj√´ bler√´s dhe pastaj nj√´ fatur√´ p√´r t√´ par√´ artikujt.</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="modal-section summary-section">
                                    <div class="sale-summary">
                                        <div class="summary-row">
                                            <span>N√´ntotali Kthimit (pa TVSH):</span>
                                            <span id="sr-total-without-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row">
                                            <span>Vlera e TVSH-s√´ (Kthim):</span>
                                            <span id="sr-total-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row total-row">
                                            <span><strong>TOTALI KTHIMIT (me TVSH):</strong></span>
                                            <span id="sr-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <p id="sales-return-form-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group" style="justify-content: flex-end;"> 
                                    <button type="submit" id="save-sales-return-btn" class="btn btn-primary">Ruaj Kthimin</button>
                                    <button type="button" id="cancel-sales-return-form-btn" class="btn btn-secondary">Anulo</button>
                                </div>
                            </form>
                        </div>

                        <!-- Credit Notes View (New) -->
                        <div id="manager-content-credit_notes" class="manager-content-section" style="display:none;">
                            <!-- Content for credit notes management will be populated by JS -->
                        </div>

                        <!-- Debit Notes View (New) -->
                        <div id="manager-content-debit_notes" class="manager-content-section" style="display:none;">
                            <!-- Content for debit notes management will be populated by JS -->
                        </div>
                        
                        <!-- Data Management View -->
                        <div id="manager-content-data_management" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Menaxhimi i t√´ Dh√´nave</h2>
                             <div class="actions-grid-container"> 
                                <button type="button" id="download-business-backup-btn" class="btn btn-info action-grid-button">
                                    <span class="icon">üì•</span> Merr Backup t√´ t√´ Dh√´nave
                                </button>
                            </div>
                        </div>
                        
                        <!-- HR View (New - Placeholder) -->
                        <div id="manager-content-hr_management" class="manager-content-section" style="display:none;">
                            <!-- #employee-management-panel will be appended here by JS -->
                        </div>
                        
                        <!-- Payroll Management View (New) -->
                        <div id="manager-content-payroll_management" class="manager-content-section" style="display:none;">
                            <p class="loading-message">Duke ngarkuar menaxhimin e pagave...</p>
                        </div>

                        <!-- User Management View (Placeholder: will contain #user-management-panel) -->
                        <div id="manager-content-user_management" class="manager-content-section" style="display:none;">
                             <!-- #user-management-panel will be appended here by JS -->
                        </div>
                        
                        <!-- Group Management View (Placeholder: will contain #group-management-panel) -->
                        <div id="manager-content-group_management" class="manager-content-section" style="display:none;">
                             <!-- #group-management-panel will be appended here by JS -->
                        </div>

                        <!-- Product Management View (Placeholder: will contain #product-management-panel) -->
                        <div id="manager-content-product_management" class="manager-content-section" style="display:none;">
                            <!-- #product-management-panel will be appended here by JS -->
                        </div>

                        <!-- Category Management View (New - Placeholder) -->
                        <div id="manager-content-category_management" class="manager-content-section" style="display:none;">
                            <!-- #category-management-panel will be appended here by JS -->
                        </div>
                        
                        <!-- Item Type Management View (New - Placeholder) -->
                        <div id="manager-content-item_type_management" class="manager-content-section" style="display:none;">
                            <!-- #item-type-management-panel will be appended here by JS -->
                        </div>

                        <!-- Deal Management View (Placeholder: will contain #deal-management-panel) -->
                        <div id="manager-content-deal_management" class="manager-content-section" style="display:none;">
                            <!-- #deal-management-panel will be appended here by JS -->
                        </div>

                        <!-- Customer Management View (Placeholder: will contain #customer-management-panel) -->
                        <div id="manager-content-customer_management" class="manager-content-section" style="display:none;">
                            <!-- #customer-management-panel will be appended here by JS -->
                        </div>

                        <!-- Supplier Management View (Placeholder) -->
                        <div id="manager-content-supplier_management" class="manager-content-section" style="display:none;">
                            <!-- #supplier-management-panel will be appended here by JS -->
                        </div>
                        
                        <!-- Stock Overview View (New) -->
                        <div id="manager-content-stock_overview" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">P√´rmbledhje e Stoqeve</h2>
                            <div class="product-search-container">
                                <span class="search-icon" aria-hidden="true">üîç</span>
                                <input type="search" id="stock-overview-search-input" placeholder="K√´rko Produkte..." class="form-control" style="padding-left: 40px; height: 48px;">
                            </div>
                            <div class="table-container" id="stock-overview-table-container">
                                <table id="stock-overview-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>Kodi</th>
                                            <th>Emri i Produktit</th>
                                            <th>Kategoria</th>
                                            <th class="text-right">Stoku Aktual</th>
                                            <th>Nj√´sia Mat√´se</th>
                                            <th>Sasia/Paketim</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stock-overview-tbody">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>


                        <!-- Local Purchases Management List View (Placeholder) -->
                        <div id="manager-content-local_purchases" class="manager-content-section" style="display:none;">
                            <!-- #local-purchase-management-panel will be appended here by JS -->
                        </div>
                         <!-- Local Purchases Management Form View (New) -->
                        <div id="manager-content-add_local_purchase" class="manager-content-section purchase-form-section" style="display:none;">
                            <h2 id="local-purchase-form-modal-title" class="manager-section-title">Shto Blerje t√´ Re Vendore</h2>
                            <form id="local-purchase-form">
                                <input type="hidden" id="edit-local-purchase-id" name="editLocalPurchaseId">
                                
                                <div class="modal-section"> 
                                    <div class="form-grid-3-cols">
                                        <div class="form-group">
                                            <label for="lp-supplier-select">Furnitori:</label>
                                            <select id="lp-supplier-select" name="supplierId" class="form-control" required></select>
                                        </div>
                                        <div class="form-group">
                                            <label for="lp-system-invoice-number">Nr. Fatur√´s (Sistem):</label>
                                            <input type="text" id="lp-system-invoice-number" name="systemInvoiceNumber" readonly class="readonly-field">
                                        </div>
                                        <div class="form-group">
                                            <label for="lp-supplier-invoice-number">Nr. Fatur√´s (Furnitor):</label>
                                            <input type="text" id="lp-supplier-invoice-number" name="supplierInvoiceNumber" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="lp-invoice-date">Data e Fatur√´s (Furnitor):</label>
                                            <input type="date" id="lp-invoice-date" name="invoiceDate" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="lp-receipt-date">Data e Pranimit:</label>
                                            <input type="date" id="lp-receipt-date" name="receiptDate" required>
                                        </div>
                                    </div>
                                </div>

                                <hr class="modal-divider">
                                
                                <div class="modal-section">
                                    <h3 class="modal-section-title">Shto Artikuj n√´ Fatur√´</h3>
                                    <div class="item-entry-grid">
                                         <div class="form-group">
                                            <label for="lp-product-select">Produkti:</label>
                                            <select id="lp-product-select" name="productId" class="form-control"></select>
                                        </div>
                                        <div class="lp-item-actions">
                                            <button type="button" id="lp-add-item-btn" class="btn btn-info">Shto Artikull</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-section table-section">
                                    <div class="table-responsive">
                                        <table class="admin-table items-table">
                                            <thead>
                                                <tr>
                                                    <th>Kodi</th>
                                                    <th>Em√´rtimi</th>
                                                    <th>Sasia</th>
                                                    <th class="text-right">√ám. Blerjes (pa TVSH)</th>
                                                    <th class="text-right">TVSH (%)</th>
                                                    <th class="text-right">√ám. Blerjes (me TVSH)</th>
                                                    <th class="text-right">Vlera Tot. (pa TVSH)</th>
                                                    <th class="text-right">Vlera Tot. (me TVSH)</th>
                                                    <th>Veprim</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lp-items-tbody">
                                                <tr><td colspan="9" class="text-center">Asnj√´ artikull i shtuar.</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="modal-section summary-section">
                                    <div class="sale-summary">
                                        <div class="summary-row">
                                            <span>N√´ntotali (pa TVSH):</span>
                                            <span id="lp-total-without-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row">
                                            <span>Vlera e TVSH-s√´:</span>
                                            <span id="lp-total-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row total-row">
                                            <span><strong>TOTALI (me TVSH):</strong></span>
                                            <span id="lp-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <p id="local-purchase-form-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group" style="justify-content: flex-end;"> 
                                    <button type="submit" id="save-local-purchase-btn" class="btn btn-primary">Ruaj Blerjen</button>
                                    <button type="button" id="cancel-local-purchase-form-btn" class="btn btn-secondary">Anulo</button>
                                </div>
                            </form>
                        </div>

                        <!-- Return Purchases Management List View (New - Placeholder) -->
                        <div id="manager-content-return_purchases_list" class="manager-content-section" style="display:none;">
                            <!-- #return-purchase-management-panel will be appended here by JS -->
                        </div>
                        
                        <!-- Return Purchases Management Form View (New) -->
                        <div id="manager-content-add_return_purchase" class="manager-content-section purchase-form-section" style="display:none;">
                            <h2 id="return-purchase-form-title" class="manager-section-title">Shto Kthim t√´ Ri Blerjeje</h2>
                            <form id="return-purchase-form">
                                <input type="hidden" id="edit-return-purchase-id" name="editReturnPurchaseId">
                                <div class="modal-section">
                                    <div class="form-grid-3-cols">
                                        <div class="form-group">
                                            <label for="rp-supplier-select">Furnitori:</label>
                                            <select id="rp-supplier-select" name="supplierId" class="form-control" required></select>
                                        </div>
                                        <div class="form-group">
                                            <label for="rp-system-invoice-number">Nr. Fatur√´s Kthimit (Sistem):</label>
                                            <input type="text" id="rp-system-invoice-number" name="systemInvoiceNumber" readonly class="readonly-field form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="rp-supplier-invoice-number">Nr. Fatur√´s Origjinale:</label>
                                            <input type="text" id="rp-supplier-invoice-number" name="supplierInvoiceNumber" readonly class="readonly-field form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="rp-invoice-date">Data e Kthimit:</label>
                                            <input type="date" id="rp-invoice-date" name="invoiceDate" required class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="rp-reason">Arsyeja e Kthimit (Opsionale):</label>
                                            <input type="text" id="rp-reason" name="reason" class="form-control">
                                        </div>
                                    </div>
                                     <!-- Container to display purchase invoices for selected supplier -->
                                    <div id="rp-supplier-purchases-list-container" style="margin-top: 1rem; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 0.5rem; display:none;">
                                        <h4 style="margin-top:0; margin-bottom:0.5rem; font-size:1.1rem; color:#555;">Faturat e Blerjes p√´r Furnitorin e Zgjedhur:</h4>
                                        <p class="info-message secondary text-center">Zgjidhni nj√´ furnitor p√´r t√´ par√´ historikun e blerjeve.</p>
                                    </div>
                                    
                                    <!-- Container to display selected original purchase details -->
                                    <div id="rp-original-purchase-details" class="info-message secondary" style="display:none; margin-top: 1rem; text-align: left;">
                                        <!-- Original purchase details will be shown here -->
                                    </div>
                                </div>
                                <hr class="modal-divider">
                                <div class="modal-section">
                                    <h3 class="modal-section-title">Artikujt nga Fatura Origjinale e Zgjedhur (P√´r Kthim)</h3>
                                </div>
                                <div class="modal-section table-section">
                                    <div class="table-responsive">
                                        <table class="admin-table items-table">
                                            <thead>
                                                <tr>
                                                    <th>Kodi</th>
                                                    <th>Em√´rtimi</th>
                                                    <th class="text-right">Sasia Origj.</th>
                                                    <th style="width: 120px;">Sasia P√´r Kthim</th>
                                                    <th class="text-right">√ám. Kthimit (pa TVSH)</th>
                                                    <th class="text-right">TVSH (%)</th>
                                                    <th class="text-right">√ám. Kthimit (me TVSH)</th>
                                                    <th class="text-right">Vlera Tot. Kthimit</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rp-items-tbody">
                                                <tr><td colspan="8" class="text-center">Zgjidhni nj√´ furnitor dhe pastaj nj√´ fatur√´ blerjeje p√´r t√´ par√´ artikujt.</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="modal-section summary-section">
                                    <div class="sale-summary">
                                        <div class="summary-row">
                                            <span>N√´ntotali Kthimit (pa TVSH):</span>
                                            <span id="rp-total-without-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row">
                                            <span>Vlera e TVSH-s√´ (Kthim):</span>
                                            <span id="rp-total-vat">0.00 ‚Ç¨</span>
                                        </div>
                                        <div class="summary-row total-row">
                                            <span><strong>TOTALI KTHIMIT (me TVSH):</strong></span>
                                            <span id="rp-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                                        </div>
                                    </div>
                                </div>
                                <p id="return-purchase-form-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group" style="justify-content: flex-end;">
                                    <button type="submit" id="save-return-purchase-btn" class="btn btn-primary">Ruaj Kthimin</button>
                                    <button type="button" id="cancel-return-purchase-form-btn" class="btn btn-secondary">Anulo</button>
                                </div>
                            </form>
                        </div>

                        <!-- Outgoing Payments View (New) -->
                        <div id="manager-content-outgoing_payments" class="manager-content-section purchase-form-section" style="display:none;">
                            <h2 class="manager-section-title">Pagesat Dal√´se ndaj Furnitor√´ve</h2>
                            
                            <form id="outgoing-payment-form">
                                <div class="modal-section"> 
                                    <input type="hidden" id="edit-outgoing-payment-id">
                                    <div class="form-grid-3-cols">
                                        <div class="form-group">
                                            <label for="op-supplier-select">Furnitori:</label>
                                            <select id="op-supplier-select" name="supplierId" class="form-control" required></select>
                                        </div>
                                        <div class="form-group">
                                            <label for="op-payment-date">Data e Pages√´s:</label>
                                            <input type="date" id="op-payment-date" name="paymentDate" class="form-control" required>
                                        </div>
                                         <div class="form-group">
                                            <label for="op-payment-method">M√´nyra e Pages√´s:</label>
                                            <select id="op-payment-method" name="paymentMethod" class="form-control" required>
                                                <option value="Cash">Cash</option>
                                                <option value="Transfert√´ Bankare">Transfert√´ Bankare</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-grid-3-cols" style="margin-top: 0.5rem;">
                                        <div class="form-group">
                                            <label for="op-total-paid-amount">Shuma Totale e Pages√´s (‚Ç¨):</label>
                                            <input type="number" id="op-total-paid-amount" name="totalPaidAmount" class="form-control" min="0.01" step="any" required placeholder="0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="op-reference">Referenca (Opsionale):</label>
                                            <input type="text" id="op-reference" name="reference" class="form-control" placeholder="ID Transaksioni, etj.">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-top: 0.5rem;">
                                        <label for="op-notes">Sh√´nime (Opsionale):</label>
                                        <textarea id="op-notes" name="notes" class="form-control" rows="2"></textarea>
                                    </div>
                                </div>

                                <div id="op-invoice-allocation-section" class="modal-section" style="display:none; margin-top: 1rem;">
                                    <h3 class="modal-section-title">Aloko Pages√´n n√´ Fatura</h3>
                                    <p id="op-remaining-allocation-display" style="font-weight: bold; margin-bottom: 0.5rem;">Shuma e Mbetur p√´r Alokim: <span id="op-remaining-allocation-amount">0.00</span> ‚Ç¨</p>
                                    <div class="table-responsive" style="max-height: 250px;"> 
                                        <table id="op-invoices-to-allocate-table" class="admin-table items-table">
                                            <thead>
                                                <tr>
                                                    <th>Nr. Fatur√´s (Sistem)</th>
                                                    <th>Nr. Fatur√´s (Furnitor)</th>
                                                    <th>Data Fatur√´s</th>
                                                    <th class="text-right">Totali Fatur√´s (‚Ç¨)</th>
                                                    <th class="text-right">Paguar Deri Tani (‚Ç¨)</th>
                                                    <th class="text-right">Balanca e Mbetur (‚Ç¨)</th>
                                                    <th class="text-right" style="width: 150px;">Paguaj K√´t√´ Fatur√´ (‚Ç¨)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="op-invoices-to-allocate-tbody"></tbody>
                                            <tfoot id="op-invoices-to-allocate-tfoot" style="font-weight: bold;">
                                                <tr>
                                                    <td colspan="3" class="text-right">Totale:</td>
                                                    <td id="op-alloc-total-invoice-amount" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="op-alloc-total-paid-so-far" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="op-alloc-total-remaining-balance" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="op-alloc-total-paying-now" class="text-right">0.00 ‚Ç¨</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                                <p id="outgoing-payment-form-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group" style="justify-content: flex-end; margin-top: 1rem;"> 
                                    <button type="button" id="save-outgoing-payment-btn" class="btn btn-primary">Ruaj Pages√´n</button>
                                    <button type="button" id="cancel-outgoing-payment-form-btn" class="btn btn-secondary">Anulo</button>
                                </div>
                            </form>
                            
                            <hr style="margin: 1.5rem 0;">

                            <div id="existing-outgoing-payments-section" class="modal-section">
                                <h3 class="modal-section-title">Pagesat e Regjistruara m√´ Par√´</h3>
                                <div class="table-container">
                                    <table id="existing-outgoing-payments-table" class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>ID Pagese</th>
                                                <th>Data</th>
                                                <th>Furnitori</th>
                                                <th class="text-right">Shuma Totale (‚Ç¨)</th>
                                                <th>M√´nyra</th>
                                                <th>Referenca</th>
                                                <th>Veprime</th>
                                            </tr>
                                        </thead>
                                        <tbody id="existing-outgoing-payments-tbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Incoming Payments View (New) -->
                        <div id="manager-content-incoming_payments" class="manager-content-section purchase-form-section" style="display:none;">
                            <h2 class="manager-section-title">Pagesat Hyr√´se nga Bler√´sit</h2>
                            
                            <form id="incoming-payment-form">
                                <input type="hidden" id="edit-incoming-payment-id">
                                <div class="modal-section">
                                    <div class="form-grid-3-cols">
                                        <div class="form-group">
                                            <label for="ip-customer-select">Bler√´si:</label>
                                            <select id="ip-customer-select" name="customerId" class="form-control" required>
                                                <option value="">-- Zgjidh Bler√´sin --</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="ip-payment-date">Data e Pages√´s:</label>
                                            <input type="date" id="ip-payment-date" name="paymentDate" class="form-control" required>
                                        </div>
                                         <div class="form-group">
                                            <label for="ip-payment-method">M√´nyra e Pages√´s:</label>
                                            <select id="ip-payment-method" name="paymentMethod" class="form-control" required>
                                                <option value="Cash">Cash</option>
                                                <option value="Transfert√´ Bankare">Transfert√´ Bankare</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-grid-3-cols" style="margin-top: 0.5rem;">
                                        <div class="form-group">
                                            <label for="ip-total-received-amount">Shuma Totale e Marr√´ (‚Ç¨):</label>
                                            <input type="number" id="ip-total-received-amount" name="totalReceivedAmount" class="form-control" min="0.01" step="any" required placeholder="0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="ip-reference">Referenca (Opsionale):</label>
                                            <input type="text" id="ip-reference" name="reference" class="form-control" placeholder="ID Transaksioni, etj.">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-top: 0.5rem;">
                                        <label for="ip-notes">Sh√´nime (Opsionale):</label>
                                        <textarea id="ip-notes" name="notes" class="form-control" rows="2"></textarea>
                                    </div>
                                </div>
                                
                                <!-- Invoice Allocation Section for Incoming Payments -->
                                <div id="ip-invoice-allocation-section" class="modal-section" style="display:none; margin-top: 1rem;">
                                    <h3 class="modal-section-title">Aloko Pages√´n n√´ Fatura</h3>
                                    <p id="ip-remaining-allocation-display" style="font-weight: bold; margin-bottom: 0.5rem;">Shuma e Mbetur p√´r Alokim: <span id="ip-remaining-allocation-amount">0.00</span> ‚Ç¨</p>
                                    <div class="table-responsive" style="max-height: 250px;"> 
                                        <table id="ip-invoices-to-allocate-table" class="admin-table items-table">
                                            <thead>
                                                <tr>
                                                    <th>Nr. Fatur√´s</th>
                                                    <th>Data Fatur√´s</th>
                                                    <th>Lloji</th>
                                                    <th class="text-right">Totali Fatur√´s (‚Ç¨)</th>
                                                    <th class="text-right">Paguar Deri Tani (‚Ç¨)</th>
                                                    <th class="text-right">Balanca e Mbetur (‚Ç¨)</th>
                                                    <th class="text-right" style="width: 150px;">Paguaj K√´t√´ Fatur√´ (‚Ç¨)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="ip-invoices-to-allocate-tbody"></tbody>
                                            <tfoot id="ip-invoices-to-allocate-tfoot" style="font-weight: bold;">
                                                <tr>
                                                    <td colspan="3" class="text-right">Totale:</td>
                                                    <td id="ip-alloc-total-invoice-amount" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="ip-alloc-total-paid-so-far" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="ip-alloc-total-remaining-balance" class="text-right">0.00 ‚Ç¨</td>
                                                    <td id="ip-alloc-total-paying-now" class="text-right">0.00 ‚Ç¨</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>

                                <p id="incoming-payment-form-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group" style="justify-content: flex-end; margin-top: 1rem;"> 
                                    <button type="submit" id="save-incoming-payment-btn" class="btn btn-primary">Ruaj Pages√´n</button>
                                    <button type="button" id="cancel-incoming-payment-form-btn" class="btn btn-secondary">Anulo</button>
                                </div>
                            </form>
                            
                            <hr style="margin: 1.5rem 0;">

                            <div id="existing-incoming-payments-section" class="modal-section">
                                <h3 class="modal-section-title">Pagesat Hyr√´se t√´ Regjistruara</h3>
                                <div class="table-container">
                                    <table id="existing-incoming-payments-table" class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>ID Pagese</th>
                                                <th>Data</th>
                                                <th>Bler√´si</th>
                                                <th class="text-right">Shuma Totale (‚Ç¨)</th>
                                                <th>M√´nyra</th>
                                                <th>Referenca</th>
                                            </tr>
                                        </thead>
                                        <tbody id="existing-incoming-payments-tbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reports Category Views -->
                        <div id="manager-content-sales_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Shitjeve</h2>
                            <div id="sales-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                         <div id="manager-content-purchases_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Blerjeve</h2>
                            <div id="purchases-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                        <div id="manager-content-production_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Prodhimit</h2>
                            <div id="production-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                        <div id="manager-content-returns_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Kthimeve</h2>
                            <div id="returns-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                        <div id="manager-content-notes_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Notave Financiare</h2>
                            <div id="notes-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                        <div id="manager-content-cash_reports" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Raportet e Ark√´s & Barazimeve</h2>
                            <div id="cash-reports-category-tiles" class="report-category-tiles-grid"></div>
                        </div>
                         <div id="manager-content-logs" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Historiku & Logjet</h2>
                            <div id="logs-category-tiles" class="report-category-tiles-grid"></div>
                        </div>

                         <!-- Item Ledger View -->
                        <div id="manager-content-item_ledger" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Kartela e Artikullit</h2>
                            <div class="report-filters-dynamic" id="item-ledger-filters-area">
                                 <div class="form-group">
                                    <label for="item-ledger-product-select">Zgjidh Produktin:</label>
                                    <select id="item-ledger-product-select" name="itemLedgerProduct" class="form-control">
                                        <option value="">-- Zgjidh Produktin --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="item-ledger-start-date">Nga Data:</label>
                                    <input type="date" id="item-ledger-start-date" name="itemLedgerStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="item-ledger-end-date">Deri m√´ Dat√´:</label>
                                    <input type="date" id="item-ledger-end-date" name="itemLedgerEndDate">
                                </div>
                                <button id="generate-item-ledger-btn" class="btn btn-primary">Gjenero Kartel√´n</button>
                            </div>
                            <div id="item-ledger-content-area" class="report-content">
                                <p class="text-center info-message info">Zgjidhni nj√´ produkt dhe periudh√´n p√´r t√´ par√´ kartel√´n.</p>
                            </div>
                            <div class="report-actions-bar" style="margin-top: 1.5rem; justify-content: flex-end;">
                                <button id="export-item-ledger-pdf-btn" class="btn btn-info" disabled><span class="icon">üìÑ</span> Eksporto PDF</button>
                                <button id="print-item-ledger-btn" class="btn btn-primary" disabled><span class="icon">üñ®Ô∏è</span> Shtyp Kartel√´n</button>
                            </div>
                        </div>

                        <!-- Supplier Ledger View (New) -->
                        <div id="manager-content-supplier_ledger" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Kartela e Furnitorit</h2>
                            <div class="report-filters-dynamic" id="supplier-ledger-filters-area">
                                <div class="form-group">
                                    <label for="supplier-ledger-supplier-select">Zgjidh Furnitorin:</label>
                                    <select id="supplier-ledger-supplier-select" name="supplierLedgerSupplier" class="form-control">
                                        <option value="">-- Zgjidh Furnitorin --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="supplier-ledger-start-date">Nga Data:</label>
                                    <input type="date" id="supplier-ledger-start-date" name="supplierLedgerStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="supplier-ledger-end-date">Deri m√´ Dat√´:</label>
                                    <input type="date" id="supplier-ledger-end-date" name="supplierLedgerEndDate">
                                </div>
                                <button id="generate-supplier-ledger-btn" class="btn btn-primary">Gjenero Kartel√´n</button>
                            </div>
                            <div id="supplier-ledger-content-area" class="report-content">
                                <p class="text-center info-message info">Zgjidhni nj√´ furnitor dhe periudh√´n p√´r t√´ par√´ kartel√´n.</p>
                            </div>
                            <div class="report-actions-bar" style="margin-top: 1.5rem; justify-content: flex-end;">
                                <button id="export-supplier-ledger-pdf-btn" class="btn btn-info" disabled><span class="icon">üìÑ</span> Eksporto PDF</button>
                                <button id="print-supplier-ledger-btn" class="btn btn-primary" disabled><span class="icon">üñ®Ô∏è</span> Shtyp Kartel√´n</button>
                            </div>
                        </div>
                        
                        <!-- Supplier Balances View (New) -->
                        <div id="manager-content-supplier_balances" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Salldo e Furnitor√´ve</h2>
                            <div class="filter-container product-search-container"> 
                                <span class="search-icon" aria-hidden="true">üîç</span>
                                <input type="search" id="supplier-balances-search-input" placeholder="K√´rko Furnitorin (Emri, Kodi)..." class="form-control">
                            </div>
                            <div class="table-container" id="supplier-balances-table-container">
                                <table id="supplier-balances-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>Kodi i Furnitorit</th>
                                            <th>Emri i Furnitorit</th>
                                            <th class="text-right">Debi Totale (‚Ç¨)</th>
                                            <th class="text-right">Kredi Totale (‚Ç¨)</th>
                                            <th class="text-right">Salldo (‚Ç¨)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="supplier-balances-tbody"></tbody>
                                </table>
                            </div>
                             <p class="info-message secondary balance-interpretation-note" style="margin-top: 1rem; font-size: 0.85em; text-align: left;">
                                <strong>Sh√´nim:</strong> Salldo pozitive (+) do t√´ thot√´ q√´ biznesi i detyrohet furnitorit. Salldo negative (-) do t√´ thot√´ q√´ furnitori i detyrohet biznesit ose biznesi ka kredi tek furnitori.
                            </p>
                        </div>


                        <!-- Customer Ledger View (New) -->
                        <div id="manager-content-customer_ledger" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Kartela e Bler√´sit</h2>
                            <div class="report-filters-dynamic" id="customer-ledger-filters-area">
                                <div class="form-group">
                                    <label for="customer-ledger-customer-select">Zgjidh Bler√´sin:</label>
                                    <select id="customer-ledger-customer-select" name="customerLedgerCustomer" class="form-control">
                                        <option value="">-- Zgjidh Bler√´sin --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="customer-ledger-start-date">Nga Data:</label>
                                    <input type="date" id="customer-ledger-start-date" name="customerLedgerStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="customer-ledger-end-date">Deri m√´ Dat√´:</label>
                                    <input type="date" id="customer-ledger-end-date" name="customerLedgerEndDate">
                                </div>
                                <button id="generate-customer-ledger-btn" class="btn btn-primary">Gjenero Kartel√´n</button>
                            </div>
                            <div id="customer-ledger-content-area" class="report-content">
                                <p class="text-center info-message info">Zgjidhni nj√´ bler√´s dhe periudh√´n p√´r t√´ par√´ kartel√´n.</p>
                            </div>
                            <div class="report-actions-bar" style="margin-top: 1.5rem; justify-content: flex-end;">
                                <button id="export-customer-ledger-pdf-btn" class="btn btn-info" disabled><span class="icon">üìÑ</span> Eksporto PDF</button>
                                <button id="print-customer-ledger-btn" class="btn btn-primary" disabled><span class="icon">üñ®Ô∏è</span> Shtyp Kartel√´n</button>
                            </div>
                        </div>
                        
                        <!-- Customer Balances View (New) -->
                        <div id="manager-content-customer_balances" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Salldo e Bler√´sve</h2>
                            <div class="filter-container product-search-container">
                                <span class="search-icon" aria-hidden="true">üîç</span>
                                <input type="search" id="customer-balances-search-input" placeholder="K√´rko Bler√´sin (Emri, Kodi)..." class="form-control">
                            </div>
                            <div class="table-container" id="customer-balances-table-container">
                                <table id="customer-balances-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>Kodi i Bler√´sit</th>
                                            <th>Emri i Bler√´sit</th>
                                            <th class="text-right">Debi Totale (‚Ç¨)</th>
                                            <th class="text-right">Kredi Totale (‚Ç¨)</th>
                                            <th class="text-right">Salldo (‚Ç¨)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customer-balances-tbody"></tbody>
                                </table>
                            </div>
                            <p class="info-message secondary balance-interpretation-note" style="margin-top: 1rem; font-size: 0.85em; text-align: left;">
                                <strong>Sh√´nim:</strong> Salldo pozitive (+) do t√´ thot√´ q√´ bler√´si i detyrohet biznesit. Salldo negative (-) do t√´ thot√´ q√´ biznesi i detyrohet bler√´sit ose bler√´si ka kredi.
                            </p>
                        </div>

                        <!-- Initial Balances View (New) -->
                        <div id="manager-content-initial_balances" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Saldot Fillestare</h2>
                            <div class="tab-navigation-container">
                                <button class="tab-button active" data-tab-target="#initial-balances-products-tab">Stoku Fillestar i Artikujve</button>
                                <button class="tab-button" data-tab-target="#initial-balances-customers-tab">Saldot Fillestare t√´ Bler√´sve</button>
                                <button class="tab-button" data-tab-target="#initial-balances-suppliers-tab">Saldot Fillestare t√´ Furnitor√´ve</button>
                            </div>
                        
                            <div id="initial-balances-products-tab" class="tab-content active">
                                <h3 class="section-subtitle">Menaxho Stoku Fillestar t√´ Artikujve</h3>
                                <div class="filter-container product-search-container">
                                    <span class="search-icon" aria-hidden="true">üîç</span>
                                    <input type="search" id="ib-product-search-input" placeholder="K√´rko Artikullin..." class="form-control">
                                </div>
                                <div class="table-container" style="max-height: 50vh; overflow-y: auto;">
                                    <table id="ib-product-stock-table" class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Kodi</th>
                                                <th>Emri i Artikullit</th>
                                                <th>Kategoria</th>
                                                <th class="text-right">Stoku Fillestar</th>
                                                <th>Nj√´sia Mat√´se</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ib-product-stock-tbody">
                                            <tr><td colspan="5" class="text-center">Duke ngarkuar artikujt...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="form-actions-group" style="margin-top:1.5rem;">
                                    <button id="ib-save-product-stock-btn" class="btn btn-primary">Ruaj Ndryshimet e Stoqeve</button>
                                </div>
                            </div>
                        
                            <div id="initial-balances-customers-tab" class="tab-content">
                                <h3 class="section-subtitle">Menaxho Saldot Fillestare t√´ Bler√´sve</h3>
                                <div class="filter-container product-search-container">
                                    <span class="search-icon" aria-hidden="true">üîç</span>
                                    <input type="search" id="ib-customer-search-input" placeholder="K√´rko Bler√´sin..." class="form-control">
                                </div>
                                <div class="table-container" style="max-height: 50vh; overflow-y: auto;">
                                    <table id="ib-customer-balance-table" class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Kodi</th>
                                                <th>Emri i Bler√´sit</th>
                                                <th class="text-right">Saldo Fillestare (‚Ç¨)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ib-customer-balance-tbody">
                                             <tr><td colspan="3" class="text-center">Duke ngarkuar bler√´sit...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                 <p class="info-message secondary balance-interpretation-note" style="margin-top: 1rem; font-size: 0.85em; text-align: left;">
                                    <strong>Sh√´nim:</strong> Saldo pozitive (+) do t√´ thot√´ q√´ bler√´si i detyrohet biznesit. Saldo negative (-) do t√´ thot√´ q√´ biznesi i detyrohet bler√´sit ose bler√´si ka kredi.
                                </p>
                                <div class="form-actions-group" style="margin-top:1.5rem;">
                                    <button id="ib-save-customer-balances-btn" class="btn btn-primary">Ruaj Saldot e Bler√´sve</button>
                                </div>
                            </div>
                        
                            <div id="initial-balances-suppliers-tab" class="tab-content">
                                <h3 class="section-subtitle">Menaxho Saldot Fillestare t√´ Furnitor√´ve</h3>
                                <div class="filter-container product-search-container">
                                    <span class="search-icon" aria-hidden="true">üîç</span>
                                    <input type="search" id="ib-supplier-search-input" placeholder="K√´rko Furnitorin..." class="form-control">
                                </div>
                                <div class="table-container" style="max-height: 50vh; overflow-y: auto;">
                                    <table id="ib-supplier-balance-table" class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Kodi</th>
                                                <th>Emri i Furnitorit</th>
                                                <th class="text-right">Saldo Fillestare (‚Ç¨)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ib-supplier-balance-tbody">
                                            <tr><td colspan="3" class="text-center">Duke ngarkuar furnitor√´t...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p class="info-message secondary balance-interpretation-note" style="margin-top: 1rem; font-size: 0.85em; text-align: left;">
                                    <strong>Sh√´nim:</strong> Saldo pozitive (+) do t√´ thot√´ q√´ biznesi i detyrohet furnitorit. Salldo negative (-) do t√´ thot√´ q√´ furnitori i detyrohet biznesit ose biznesi ka kredi tek furnitori.
                                </p>
                                <div class="form-actions-group" style="margin-top:1.5rem;">
                                    <button id="ib-save-supplier-balances-btn" class="btn btn-primary">Ruaj Saldot e Furnitor√´ve</button>
                                </div>
                            </div>
                        </div>


                        <!-- Subscription Info View -->
                        <div id="manager-content-subscription" class="manager-content-section" style="display:none;">
                            <h2 class="manager-section-title">Informacioni i Abonimit</h2>
                            <div id="manager-subscription-info-card-content" class="card-like-content">
                                <div id="active-subscription-details">
                                    <p>Paketa Aktive: <strong id="sub-info-package-name">N/A</strong></p>
                                    <p>Data e Skadimit: <strong id="sub-info-expiry-date">N/A</strong></p>
                                    <p>Statusi: <strong id="sub-info-status" class="status-badge">N/A</strong></p>
                                    <div id="sub-info-features-list-container" style="margin-top: 1rem;">
                                        <h4 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Ve√ßorit√´ e Pakos Aktuale:</h4>
                                        <ul id="sub-info-features-list" class="package-features-display-list">
                                            <li>Duke ngarkuar ve√ßorit√´...</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="expired-subscription-activation-form" style="display: none; margin-top: 1.5rem;">
                                    <p id="expired-sub-message" class="error-message" style="font-weight: bold;">Abonimi juaj ka skaduar!</p>
                                    <p id="expired-sub-instruction" style="margin-bottom: 1rem;">Ju lutem p√´rdorni kodin e abonimit t√´ ri t√´ gjeneruar nga administratori p√´r t√´ riaktivizuar sh√´rbimin.</p>
                                    <div class="form-group" id="activation-code-input-group">
                                        <label for="new-subscription-activation-code">Kodi i Aktivizimit t√´ Abonimit t√´ Ri:</label>
                                        <input type="text" id="new-subscription-activation-code" class="form-control" placeholder="Futni kodin">
                                    </div>
                                    <button id="activate-new-subscription-btn" class="btn btn-success" style="margin-top:1rem;">Aktivizo Abonimin e Ri</button>
                                    <p id="subscription-activation-error" class="error-message" style="margin-top: 0.5rem;"></p>
                                </div>
                            </div>

                                                 <div id="subscription-upgrade-options-container" style="margin-top: 2rem;">
                                <h3 class="manager-section-title" style="font-size: 1.4rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; margin-bottom: 1rem;">Opsione p√´r P√´rmir√´sim t√´ Pakos</h3>
                                <div id="upgrade-options-list" class="report-category-tiles-grid">
                                    <p class="info-message info" id="no-upgrade-options-message" style="display:none;">Nuk ka pako m√´ t√´ larta t√´ disponueshme p√´r momentin, ose jeni n√´ pakon m√´ t√´ lart√´.</p>
                                </div>
                                <p id="manager-upgrade-request-status" class="info-message" style="display:none; margin-top: 1rem;"></p>
                            </div>
                        </div>
                    </div> <!-- End of manager-tab-content-area -->
                </div>
            </div>
            
            <!-- Super Admin Panel View -->
            <div id="super-admin-panel-view" style="display: none;">
                <nav id="super-admin-sidebar">
                    <div class="sidebar-header">
                        <h3 id="super-admin-sidebar-title">Super Admin</h3>
                    </div>
                    <div class="sidebar-main-actions">
                        <button id="super-admin-sidebar-add-business-btn" class="btn btn-primary btn-block">Shto Biznes t√´ Ri</button>
                        <button id="super-admin-sidebar-view-businesses-btn" class="btn btn-info btn-block">Shiko Bizneset</button>
                        <button id="super-admin-sidebar-manage-packages-btn" class="btn btn-secondary btn-block">Menaxho Pakot e Abonimit</button>
                        <button id="super-admin-sidebar-manage-manager-menu-btn" class="btn btn-secondary btn-block">Menaxho Menun√´ e Menaxherit</button> 
                        <button id="super-admin-sidebar-app-settings-btn" class="btn btn-secondary btn-block">Cil√´simet e Aplikacionit</button>
                        <button id="super-admin-sidebar-change-password-btn" class="btn btn-secondary btn-block">Ndrysho Fjal√´kalimin</button>
                    </div>
                    <button id="super-admin-sidebar-logout-btn" class="btn btn-danger btn-block">Dilni (Super Admin)</button>
                </nav>

                <div id="super-admin-content-area">
                    <div id="super-admin-content-welcome" class="info-message info">
                        Mir√´ se erdhe, Super Admin! Zgjidh nj√´ veprim nga menyja an√´sore, ose shtyp 'Shiko Bizneset' p√´r t√´ par√´ list√´n e bizneseve.
                    </div>

                    <div id="super-admin-content-business-list" style="display: none;">
                        <h2 class="section-title">Lista e Biznesve</h2>
                        <div id="sa-business-list-container" class="sa-business-list-content-area">
                            <p class="empty-list-message">Nuk ka biznese t√´ regjistruara. Shtyp "Shto Biznes t√´ Ri" nga menyja.</p>
                        </div>
                    </div>

                    <div id="super-admin-content-managing-business" style="display: none;">
                        <div id="currently-managing-business-display-content-area" class="info-message success" style="margin-bottom: 1rem; text-align: left;"></div>
                         <div id="sa-business-upgrade-request-info" class="info-message warning" style="display: none; margin-bottom: 1rem; text-align: left;"></div>
                        
                        <section id="business-details-section" class="dashboard-section">
                            <h3 class="section-title">Detajet e Biznesit</h3>
                            <form id="business-details-form">
                                <div class="form-group">
                                    <label for="business-name-input">Emri i Biznesit:</label>
                                    <input type="text" id="business-name-input" name="businessName" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="business-address-input">Adresa e Biznesit:</label>
                                    <input type="text" id="business-address-input" name="businessAddress" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="business-nipt-input">NIPT i Biznesit:</label>
                                    <input type="text" id="business-nipt-input" name="businessNipt" disabled>
                                </div>
                                <div class="form-group">
                                    <label for="business-logo-input-sa">Logo e Biznesit:</label>
                                    <input type="file" id="business-logo-input-sa" name="businessLogoSA" accept="image/*" class="form-control-file" disabled>
                                    <div class="logo-preview-container">
                                        <img id="business-logo-preview-sa" src="#" alt="Pamje paraprake e logos" class="logo-preview-image">
                                    </div>
                                </div>
                                <div class="form-actions-group">
                                    <button type="submit" id="save-business-details-btn" class="btn btn-primary" disabled>Ruaj Detajet</button>
                                    <button type="button" id="delete-business-logo-btn-sa" class="btn btn-warning" disabled style="display: none;">Fshij Logon</button>
                                    <button type="button" id="delete-current-business-btn" class="btn btn-danger" disabled>Fshij k√´t√´ Biznes</button>
                                </div>
                            </form>
                        </section>

                        <hr class="section-divider">

                        <section id="fiscal-year-management-section" class="dashboard-section">
                             <h3 class="section-title">Menaxhimi i Vitit Fiskal</h3>
                             <button type="button" id="openNewFiscalYearBtn" class="btn btn-info" disabled style="display:none;">Hap Vit Fiskal t√´ Ri</button>
                        </section>

                        <hr class="section-divider">

                        <section id="future-subscription-management-section" class="dashboard-section">
                            <h3 class="section-title">Menaxhimi i Abonimit t√´ Ardhsh√´m</h3>
                            <div id="existing-future-subscription-info" style="display: none; margin-bottom: 1rem;">
                                <p><strong>Kodi i Abonimit t√´ Ardhsh√´m Ekzistues:</strong></p>
                                <p>Kodi: <code id="display-future-sub-code"></code></p>
                                <p>Paketa: <span id="display-future-sub-package"></span></p>
                                <p>Gjeneruar m√´: <span id="display-future-sub-generated-date"></span></p>
                            </div>
                            <div class="form-group">
                                <label for="future-subscription-package-select">Zgjidh Pakon p√´r Abonimin e Ri/T√´ Ardhsh√´m:</label>
                                <select id="future-subscription-package-select" class="form-control" disabled></select>
                            </div>
                            <div class="future-subscription-actions-group">
                                <button type="button" id="generate-future-subscription-code-btn" class="btn btn-success" disabled>Gjenero Kod t√´ Ri Abonimi</button>
                                <button type="button" id="apply-selected-package-now-btn" class="btn btn-primary" disabled>Apliko Paket√´n Menj√´her√´</button>
                            </div>
                            <div id="newly-generated-future-code-display" class="info-message success" style="display: none; margin-top: 1rem;">
                                Kodi i ri i abonimit t√´ ardhsh√´m u gjenerua: <strong id="newly-generated-future-code-value"></strong>
                            </div>
                        </section>

                        <hr class="section-divider">
                        
                        <section id="business-backup-restore-section" class="dashboard-section">
                            <h3 class="section-title">Backup & Rikthim i t√´ Dh√´nave</h3>
                            <button type="button" id="restore-business-backup-btn" class="btn btn-warning" disabled style="margin-left: 0px;">Rikthe Backup t√´ Dh√´nash</button>
                            <input type="file" id="backup-file-input" accept=".json" style="display: none;">
                        </section>

                        <hr class="section-divider">

                        <section id="super-admin-manage-managers-section" class="dashboard-section admin-panel">
                            <div class="admin-panel-header">
                                <h3 class="section-title">Menaxho Menaxher√´t</h3>
                                <div class="admin-panel-actions">
                                    <button id="super-admin-show-add-manager-modal-btn" class="btn btn-primary" disabled>Shto Menaxher</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="super-admin-manager-list-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>P√´rdoruesi</th>
                                            <th>Veprime</th>
                                        </tr>
                                    </thead>
                                    <tbody id="super-admin-manager-list-tbody">
                                        <tr><td colspan="2" class="text-center">Zgjidhni nj√´ biznes.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>

                        <section id="super-admin-manage-sellers-section" class="dashboard-section admin-panel">
                             <div class="admin-panel-header">
                                <h3 class="section-title">Menaxho Shit√´sit</h3>
                                <div class="admin-panel-actions">
                                    <button id="super-admin-show-add-seller-modal-btn" class="btn btn-primary" disabled>Shto Shit√´s</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="super-admin-seller-list-table" class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>P√´rdoruesi</th>
                                            <th>Veprime</th>
                                        </tr>
                                    </thead>
                                    <tbody id="super-admin-seller-list-tbody">
                                         <tr><td colspan="2" class="text-center">Zgjidhni nj√´ biznes.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>
                    </div>

                    <div id="super-admin-content-password-change" style="display: none;">
                        <section id="super-admin-password-section" class="dashboard-section">
                            <h3 class="section-title">Ndrysho Fjal√´kalimin e Super Adminit</h3>
                            <form id="super-admin-password-form">
                                <div class="form-group">
                                    <label for="current-super-admin-password">Fjal√´kalimi Aktual:</label>
                                    <input type="password" id="current-super-admin-password" name="currentSuperAdminPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-super-admin-password">Fjal√´kalimi i Ri:</label>
                                    <input type="password" id="new-super-admin-password" name="newSuperAdminPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="confirm-new-super-admin-password">Konfirmo Fjal√´kalimin e Ri:</label>
                                    <input type="password" id="confirm-new-super-admin-password" name="confirmNewSuperAdminPassword" required>
                                </div>
                                <p id="super-admin-password-error" class="error-message" aria-live="polite"></p>
                                <button type="submit" id="change-super-admin-password-btn" class="btn btn-primary">Ndrysho Fjal√´kalimin</button>
                            </form>
                        </section>
                    </div>
                    
                    <!-- Super Admin Application Settings View -->
                    <div id="super-admin-content-app-settings" style="display: none;">
                        <section class="dashboard-section">
                            <h3 class="section-title">Cil√´simet Kryesore t√´ Aplikacionit</h3>
                            <form id="super-admin-app-settings-form">
                                <div class="form-group">
                                    <label for="sa-app-name-input">Emri Kryesor i Aplikacionit:</label>
                                    <input type="text" id="sa-app-name-input" name="mainAppName">
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-logo-input">Logo Kryesore e Aplikacionit:</label>
                                    <input type="file" id="sa-app-logo-input" name="mainAppLogo" accept="image/*" class="form-control-file">
                                    <div class="logo-preview-container">
                                        <img id="sa-app-logo-preview" src="#" alt="Pamje paraprake e logos kryesore" class="logo-preview-image">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-address-input">Adresa Kryesore e Aplikacionit:</label>
                                    <input type="text" id="sa-app-address-input" name="mainAppAddress">
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-nipt-input">NIPT/ID Kryesor i Aplikacionit:</label>
                                    <input type="text" id="sa-app-nipt-input" name="mainAppNipt">
                                </div>
                                
                                <h4 class="section-subtitle" style="margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 1.2rem; color: #333;">Tekstet e Hyrjes (Showcase)</h4>
                                <div class="form-group">
                                    <label for="sa-login-showcase-title-prefix">Prefiksi i Titullit t√´ Hyrjes:</label>
                                    <input type="text" id="sa-login-showcase-title-prefix" name="loginShowcaseTitlePrefix" placeholder="P.sh., Mir√´ se vini n√´">
                                </div>
                                <div class="form-group">
                                    <label for="sa-login-showcase-subtitle">N√´ntitulli i Hyrjes:</label>
                                    <input type="text" id="sa-login-showcase-subtitle" name="loginShowcaseSubtitle" placeholder="P.sh., Zgjidhja juaj e plot√´...">
                                </div>


                                <h4 class="section-subtitle" style="margin-top: 1.5rem; margin-bottom: 1rem; font-size: 1.2rem; color: #333;">T√´ Dh√´nat Bankare</h4>
                                <div class="form-group">
                                    <label for="sa-app-bank-name-input">Emri i Bank√´s:</label>
                                    <input type="text" id="sa-app-bank-name-input" name="mainAppBankName">
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-bank-account-input">Numri i Llogaris√´ Bankare:</label>
                                    <input type="text" id="sa-app-bank-account-input" name="mainAppBankAccountNumber">
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-iban-input">IBAN:</label>
                                    <input type="text" id="sa-app-iban-input" name="mainAppIban">
                                </div>
                                <div class="form-group">
                                    <label for="sa-app-swift-input">SWIFT/BIC:</label>
                                    <input type="text" id="sa-app-swift-input" name="mainAppSwift">
                                </div>
                    
                                <p id="sa-app-settings-error" class="error-message" aria-live="polite"></p>
                                <div class="form-actions-group">
                                    <button type="submit" id="sa-save-app-settings-btn" class="btn btn-primary">Ruaj Cil√´simet</button>
                                    <button type="button" id="sa-delete-app-logo-btn" class="btn btn-warning" style="display: none;">Fshij Logon Kryesore</button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <!-- Super Admin Subscription Package Management View -->
                    <div id="super-admin-content-subscription-packages" class="admin-panel" style="display: none;">
                        <div class="admin-panel-header">
                            <h2 class="section-title">Menaxhimi i Pakove t√´ Abonimit</h2>
                            <div class="admin-panel-actions">
                                <button id="sa-show-add-package-modal-btn" class="btn btn-primary">Shto Pako t√´ Re</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="sa-subscription-package-list-table" class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID Pakos</th>
                                        <th>Emri i Pakos</th>
                                        <th class="text-right">√ámimi (‚Ç¨)</th>
                                        <th class="text-center">Koh√´zgjatja (Vite)</th>
                                        <th>Ve√ßorit√´</th>
                                        <th>Veprime</th>
                                    </tr>
                                </thead>
                                <tbody id="sa-subscription-package-list-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Super Admin Manager Menu Management View (New) -->
                    <div id="super-admin-content-manager-menu" class="admin-panel" style="display: none;">
                        <div class="admin-panel-header">
                            <h2 class="section-title">Menaxhimi i Menys√´ s√´ Menaxherit</h2>
                            <div class="admin-panel-actions">
                                <button id="sa-save-manager-menu-btn" class="btn btn-success">Ruaj Ndryshimet e Menus√´</button>
                                <button id="sa-reset-manager-menu-btn" class="btn btn-warning">Rivendos Menun√´ Standarde</button>
                            </div>
                        </div>
                        <div id="manager-menu-editor-container">
                            <p class="loading-message">Duke ngarkuar konfigurimin e menys√´...</p>
                        </div>
                    </div>


                </div>
            </div>
             
             <!-- Moved Panels: These will be appended by JS into the new manager-main-content structure -->
            <div id="manager-panel-staging-area" style="display:none;">
                <!-- Accounting Staging Area -->
                <section id="manager-content-chart_of_accounts" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Plani Kontab√´l</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-account-modal-btn" class="btn btn-primary">Shto Llogari t√´ Re</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="chart-of-accounts-table" class="admin-table">
                            <tbody id="chart-of-accounts-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
                <section id="manager-content-general_ledger" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Libri i P√´rgjithsh√´m</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-journal-entry-modal-btn" class="btn btn-primary">Shto Veprim Kontab√´l</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="general-ledger-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Nr. Veprimit</th>
                                    <th>P√´rshkrimi</th>
                                    <th class="text-right">Debi (‚Ç¨)</th>
                                    <th class="text-right">Kredi (‚Ç¨)</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="general-ledger-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
                <section id="manager-content-balance_sheet" class="manager-content-section">
                    <!-- Content will be generated by JS -->
                </section>
                <section id="manager-content-accounting_settings" class="manager-content-section" style="display:none;"></section>
                <!-- Other Staged Panels -->
                <section id="user-management-panel" class="dashboard-section admin-panel">
                        <div class="admin-panel-header">
                            <h2 class="section-title">Menaxhimi i P√´rdoruesve</h2>
                            <div class="admin-panel-actions">
                                <button id="show-add-user-modal-btn" class="btn btn-primary">Shto P√´rdorues t√´ Ri</button>
                            </div>
                        </div>
                        <div id="user-list-table-container" class="table-container">
                            <table id="user-list-table" class="admin-table">
                                <thead>
                                    <tr>
                                        <th>P√´rdoruesi</th>
                                        <th>Roli</th>
                                        <th>Grupi</th>
                                        <th>Veprime</th>
                                    </tr>
                                </thead>
                                <tbody id="user-list-tbody"></tbody>
                            </table>
                        </div>
                </section>
                <section id="group-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Grupeve</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-group-modal-btn" class="btn btn-primary">Shto Grup t√´ Ri</button>
                        </div>
                    </div>
                    <div id="group-list-table-container" class="table-container">
                        <table id="group-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Grupit</th>
                                    <th>P√´rshkrimi</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="group-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="product-management-panel" class="dashboard-section admin-panel">
                         <div class="admin-panel-header">
                            <h2 class="section-title">Menaxhimi i Produkteve</h2>
                            <div class="admin-panel-actions">
                                <button id="show-add-product-modal-btn" class="btn btn-primary">Shto Produkt t√´ Ri</button>
                            </div>
                        </div>
                        <div id="product-list-manager-table-container" class="table-container">
                            <table id="product-list-manager-table" class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Kodi</th>
                                        <th>Emri i Produktit</th>
                                        <th>Kategoria</th>
                                        <th>√ámimi (‚Ç¨)</th>
                                        <th>Stoku</th>
                                        <th>Nj√´sia</th>
                                        <th>Statusi</th>
                                        <th>Veprime</th>
                                    </tr>
                                </thead>
                                <tbody id="product-list-manager-tbody"></tbody>
                            </table>
                        </div>
                </section>
                 <section id="category-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Kategorive t√´ Produkteve</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-category-modal-btn" class="btn btn-primary">Shto Kategori t√´ Re</button>
                        </div>
                    </div>
                    <div id="category-list-table-container" class="table-container">
                        <table id="category-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Kategoris√´</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="category-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="item-type-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Llojeve t√´ Artikujve</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-item-type-modal-btn" class="btn btn-primary">Shto Lloj t√´ Ri Artikulli</button>
                        </div>
                    </div>
                    <div id="item-type-list-table-container" class="table-container">
                        <table id="item-type-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Llojit</th>
                                    <th>P√´rshkrimi</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="item-type-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="deal-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                       <h2 class="section-title">Menaxhimi i Ofertave</h2>
                       <div class="admin-panel-actions">
                           <button id="show-add-deal-modal-btn" class="btn btn-primary">Shto Ofert√´ t√´ Re</button>
                       </div>
                   </div>
                   <div id="deal-list-table-container" class="table-container">
                       <table id="deal-list-table" class="admin-table">
                           <thead>
                               <tr>
                                   <th>Emri i Ofert√´s</th>
                                   <th>√ámimi (‚Ç¨)</th>
                                   <th>Artikujt e P√´rfshir√´</th>
                                   <th>Statusi</th>
                                   <th>Veprime</th>
                               </tr>
                           </thead>
                           <tbody id="deal-list-tbody"></tbody>
                       </table>
                   </div>
                </section>
                <section id="customer-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                       <h2 class="section-title">Menaxhimi i Bler√´sve</h2>
                       <div class="admin-panel-actions">
                           <button id="show-add-customer-modal-btn" class="btn btn-primary">Shto Bler√´s t√´ Ri</button>
                       </div>
                   </div>
                   <div id="customer-list-table-container" class="table-container">
                       <table id="customer-list-table" class="admin-table">
                           <thead>
                               <tr>
                                   <th>Emri i Bler√´sit</th>
                                   <th>Statusi Default</th>
                                   <th>Veprime</th>
                               </tr>
                           </thead>
                           <tbody id="customer-list-tbody"></tbody>
                       </table>
                   </div>
                </section>
                <section id="supplier-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                       <h2 class="section-title">Menaxhimi i Furnitor√´ve</h2>
                       <div class="admin-panel-actions">
                           <button id="show-add-supplier-modal-btn" class="btn btn-primary">Shto Furnitor t√´ Ri</button>
                       </div>
                   </div>
                   <div id="supplier-list-table-container" class="table-container">
                       <table id="supplier-list-table" class="admin-table">
                           <thead>
                               <tr>
                                   <th>Kodi</th>
                                   <th>Emri i Furnitorit</th>
                                   <th>Personi Kontaktues</th>
                                   <th>Telefoni</th>
                                   <th>NIPT</th>
                                   <th>Veprime</th>
                               </tr>
                           </thead>
                           <tbody id="supplier-list-tbody"></tbody>
                       </table>
                   </div>
                </section>
                <section id="employee-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Punonj√´sve</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-employee-modal-btn" class="btn btn-primary">Shto Punonj√´s t√´ Ri</button>
                        </div>
                    </div>
                    <div class="filter-container product-search-container">
                        <span class="search-icon" aria-hidden="true">üîç</span>
                        <input type="search" id="employee-list-search-input" placeholder="K√´rko Punonj√´s (Em√´r, Mbiem√´r, Pozicion)..." class="form-control">
                    </div>
                    <div id="employee-list-table-container" class="table-container">
                        <table id="employee-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Plot√´</th>
                                    <th>Pozicioni</th>
                                    <th>Departamenti</th>
                                    <th>Telefoni</th>
                                    <th>Statusi</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="employee-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                 <section id="local-purchase-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                       <h2 class="section-title">Menaxhimi i Blerjeve Vendore</h2>
                       <div class="admin-panel-actions">
                           <button id="show-add-local-purchase-modal-btn" class="btn btn-primary">Shto Blerje t√´ Re</button>
                       </div>
                   </div>
                   <div id="local-purchase-list-table-container" class="table-container">
                       <table id="local-purchase-list-table" class="admin-table">
                           <thead>
                               <tr>
                                   <th>Nr. Fature (Sistem)</th>
                                   <th>Furnitori</th>
                                   <th>Nr. Fature (Furnitor)</th>
                                   <th>Data Fatures</th>
                                   <th>Data Pranimi</th>
                                   <th class="text-right">Totali (‚Ç¨)</th>
                                   <th>Statusi Pages√´s</th>
                                   <th>Veprime</th>
                               </tr>
                           </thead>
                           <tbody id="local-purchase-list-tbody">
                                <tr><td colspan="8" class="text-center">Nuk ka blerje t√´ regjistruara.</td></tr>
                           </tbody>
                       </table>
                   </div>
                </section>
                <section id="return-purchase-management-panel" class="dashboard-section admin-panel">
                    <div class="admin-panel-header">
                       <h2 class="section-title">Menaxhimi i Kthimeve t√´ Blerjeve</h2>
                       <div class="admin-panel-actions">
                           <button id="show-add-return-purchase-form-btn" class="btn btn-primary">Shto Kthim Blerjeje</button>
                       </div>
                   </div>
                   <div id="return-purchase-list-table-container" class="table-container">
                       <table id="return-purchase-list-table" class="admin-table">
                           <thead>
                               <tr>
                                   <th>Nr. Fature Kthimi (Sistem)</th>
                                   <th>Furnitori</th>
                                   <th>Nr. Fature (Furnitor, Ref.)</th>
                                   <th>Data Kthimit</th>
                                   <th class="text-right">Vlera Tot. Kthimit (‚Ç¨)</th>
                                   <th>Veprime</th>
                               </tr>
                           </thead>
                           <tbody id="return-purchase-list-tbody">
                               <tr><td colspan="6" class="text-center">Nuk ka kthime blerjesh t√´ regjistruara.</td></tr>
                           </tbody>
                       </table>
                   </div>
                </section>
                <section id="recipe-management-panel" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Recetave (BOM)</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-recipe-modal-btn" class="btn btn-primary">Shto Recet√´ t√´ Re</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="recipe-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Recet√´s</th>
                                    <th>Produkti Final</th>
                                    <th>P√´rb√´r√´sit</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="recipe-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="production-order-panel" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Urdh√´rat e Prodhimit</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-production-order-modal-btn" class="btn btn-primary">Krijo Urdh√´r Prodhimi</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="production-order-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID Urdh√´ri</th>
                                    <th>Data</th>
                                    <th>Produkti Final</th>
                                    <th class="text-right">Sasia p√´r Prodhim</th>
                                    <th>Statusi</th>
                                    <th>Krijuar Nga</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="production-order-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="production-stage-panel" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Menaxhimi i Hapave t√´ Prodhimit</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-production-stage-modal-btn" class="btn btn-primary">Shto Faz√´ t√´ Re</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="production-stage-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Faz√´s</th>
                                    <th>P√´rshkrimi</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="production-stage-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <section id="production-routing-panel" class="manager-content-section admin-panel">
                    <div class="admin-panel-header">
                        <h2 class="section-title">Proceset Teknologjike (Routings)</h2>
                        <div class="admin-panel-actions">
                            <button id="show-add-production-routing-modal-btn" class="btn btn-primary">Shto Proces t√´ Ri</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="production-routing-list-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th>Emri i Procesit</th>
                                    <th>Hapat</th>
                                    <th>Veprime</th>
                                </tr>
                            </thead>
                            <tbody id="production-routing-list-tbody"></tbody>
                        </table>
                    </div>
                </section>
                <!-- Report View Template -->
                <div id="manager-report-view-template" style="display:none;">
                    <div class="report-view-header">
                        <button class="btn btn-secondary back-to-reports-btn"><span class="icon">‚¨ÖÔ∏è</span> Kthehu te Lista e Raporteve</button>
                        <h2 class="section-title">Raporti</h2>
                        <div class="report-actions-bar">
                            <button class="btn btn-info export-pdf-btn"><span class="icon">üìÑ</span> Eksporto PDF</button>
                            <button class="btn btn-success export-excel-btn"><span class="icon">üìä</span> Eksporto Excel (CSV)</button>
                            <button class="btn btn-primary print-report-btn"><span class="icon">üñ®Ô∏è</span> Shtyp Raportin</button>
                        </div>
                    </div>
                    <div class="report-filters-dynamic"></div>
                    <div class="report-content"></div>
                </div>

                <!-- Template for common filters, remains hidden -->
                <div id="common-report-filters-template" style="display:none;" class="report-filters">
                    <div class="form-group" id="filter-group-date-range">
                        <label for="filter-start-date">Nga Data:</label>
                        <input type="date" id="filter-start-date">
                        <label for="filter-end-date">Deri m√´ Dat√´:</label>
                        <input type="date" id="filter-end-date">
                    </div>
                    <div class="form-group" id="filter-group-month-year">
                        <label for="filter-month-select">Muaji:</label>
                        <select id="filter-month-select"></select>
                        <label for="filter-year-input">Viti:</label>
                        <input type="number" id="filter-year-input" placeholder="YYYY">
                    </div>
                     <div class="form-group" id="filter-group-single-date">
                        <label for="filter-single-date">Data:</label>
                        <input type="date" id="filter-single-date">
                    </div>
                    <div class="form-group" id="filter-group-seller">
                        <label for="filter-seller-select">Shit√´si:</label>
                        <select id="filter-seller-select">
                            <option value="">T√´ gjith√´</option>
                        </select>
                    </div>
                    <div class="form-group" id="filter-group-shift">
                        <label for="filter-shift-select">Nd√´rrimi:</label>
                        <select id="filter-shift-select">
                            <option value="">T√´ gjitha</option>
                            <option value="paradite">Paradite</option>
                            <option value="masdite">Masdite</option>
                        </select>
                    </div>
                    <div class="form-group" id="filter-group-product">
                        <label for="filter-product-select">Produkti:</label>
                        <select id="filter-product-select">
                            <option value="">T√´ gjith√´</option>
                        </select>
                    </div>
                    <div class="form-group" id="filter-group-category">
                        <label for="filter-category-select">Kategoria:</label>
                        <select id="filter-category-select">
                            <option value="">T√´ gjitha</option>
                        </select>
                    </div>
                    <div class="form-group" id="filter-group-customer">
                        <label for="filter-customer-select">Bler√´si:</label>
                        <select id="filter-customer-select">
                            <option value="">T√´ gjith√´</option>
                        </select>
                    </div>
                    <button id="generate-dynamic-report-btn" class="btn btn-primary">Gjenero Raportin</button>
                </div>
            </div>

        </main>
    </div>

    <div id="page-blur-overlay"></div>

    <!-- Modals -->
     <div id="start-day-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Ngarkimi i Ark√´s Ditore P√´r Shit√´s</h2>
            <form id="start-day-form">
                <div class="form-group">
                    <label for="select-seller">Zgjidh Shit√´sin:</label>
                    <select id="select-seller" name="seller" required></select>
                </div>
                <div class="form-group">
                    <label for="select-shift">Zgjidh Nd√´rrimin:</label>
                    <select id="select-shift" name="shift" required>
                        <option value="paradite">Paradite</option>
                        <option value="masdite">Masdite</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="initial-cash">Shuma Fillestare n√´ Ark√´ (‚Ç¨):</label>
                    <input type="number" id="initial-cash" name="initialCash" min="0" step="any" required>
                </div>
                <!-- Removed Product Stock Section
                <div class="form-group">
                    <h3>Stoku i Produkteve</h3>
                    <div id="modal-product-stock-list" class="modal-product-list"></div>
                </div>
                -->
                <div class="modal-actions">
                    <button type="submit" id="save-start-day-btn" class="btn btn-primary">Ruaj Ngarkimin</button>
                    <button type="button" id="cancel-start-day-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="edit-open-cash-entry-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="edit-open-cash-entry-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Modifiko Ark√´n e Hapur</h2>
            <form id="edit-open-cash-entry-form">
                <div class="form-group">
                    <label for="select-entry-to-edit-dropdown">Zgjidh Nd√´rrimin p√´r Modifikim:</label>
                    <select id="select-entry-to-edit-dropdown" name="entryToEdit" required></select>
                </div>

                <div id="edit-entry-details-view" style="display:none; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px dashed #ccc;">
                    <p><strong>Shit√´si:</strong> <span id="edit-entry-seller-username-element"></span></p>
                    <p><strong>Data:</strong> <span id="edit-entry-date-element"></span></p>
                    <p><strong>Nd√´rrimi:</strong> <strong id="edit-entry-shift-element"></strong></p>

                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="edit-initial-cash-input">Shuma Fillestare n√´ Ark√´ (‚Ç¨):</label>
                        <input type="number" id="edit-initial-cash-input" name="initialCash" min="0" step="any" required>
                    </div>
                </div>

                <p id="edit-open-cash-entry-error" class="error-message" aria-live="polite"></p>

                <div class="modal-actions">
                    <button type="submit" id="save-edit-open-cash-entry-btn" class="btn btn-primary" disabled>Ruaj Ndryshimet</button>
                    <button type="button" id="cancel-edit-open-cash-entry-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="user-form-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="user-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="user-form-modal-title">Shto P√´rdorues t√´ Ri</h2>
            <form id="user-form">
                <input type="hidden" id="edit-user-id" name="editUserId">
                <div class="form-group">
                    <label for="user-form-username">P√´rdoruesi:</label>
                    <input type="text" id="user-form-username" name="username" required>
                </div>
                <div class="form-group" id="user-form-password-group">
                    <label for="user-form-password">Fjal√´kalimi:</label>
                    <input type="password" id="user-form-password" name="password">
                    <small id="user-form-password-help">L√´reni bosh p√´r t√´ mos ndryshuar fjal√´kalimin ekzistues (kur modifikoni).</small>
                </div>
                <div class="form-group">
                    <label for="user-form-role">Roli:</label>
                    <select id="user-form-role" name="role" required>
                    </select>
                </div>
                <div class="form-group">
                    <label for="user-form-group">Grupi:</label>
                    <select id="user-form-group" name="group">
                        <option value="">-- Pa Grup --</option>
                    </select>
                </div>
                <p id="user-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-user-btn" class="btn btn-primary">Ruaj</button>
                    <button type="button" id="cancel-user-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="group-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="group-form-modal-close-btn">&times;</span>
            <h2 id="group-form-modal-title">Shto Grup t√´ Ri</h2>
            <form id="group-form">
                <input type="hidden" id="edit-group-id">
                <div class="form-group">
                    <label for="group-name-input">Emri i Grupit:</label>
                    <input type="text" id="group-name-input" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="group-description-input">P√´rshkrimi:</label>
                    <textarea id="group-description-input" class="form-control" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <h3>Lejet e Grupit</h3>
                    <div id="group-privileges-container" class="package-permissions-grid">
                        <p class="loading-message">Duke ngarkuar lejet...</p>
                    </div>
                </div>
                <p id="group-form-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Ruaj Grupin</button>
                    <button type="button" id="cancel-group-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="product-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="product-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="product-form-modal-title">Shto Produkt t√´ Ri</h2>
            <form id="product-form">
                <input type="hidden" id="edit-product-id" name="editProductId">
                 <div class="form-grid-3-cols">
                    <div class="form-group">
                        <label for="product-form-code">Kodi i Produktit:</label>
                        <input type="text" id="product-form-code" name="code" readonly class="readonly-field">
                    </div>
                    <div class="form-group">
                        <label for="product-form-name">Emri i Produktit:</label>
                        <input type="text" id="product-form-name" name="name" required>
                    </div>
                     <div class="form-group">
                        <label for="product-form-barcode">Barkodi (Opsional):</label>
                        <input type="text" id="product-form-barcode" name="barcode" placeholder="P.sh., 1234567890123">
                    </div>
                    <div class="form-group">
                        <label for="product-form-price">√ámimi Shitjes (‚Ç¨):</label>
                        <input type="number" id="product-form-price" name="price" min="0" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="product-form-category">Kategoria e Produktit:</label>
                        <select id="product-form-category" name="category" class="form-control">
                            <option value="">-- Zgjidh Kategorin√´ --</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="product-form-item-type">Lloji i Artikullit:</label>
                        <select id="product-form-item-type" name="itemTypeId" class="form-control">
                            <option value="">-- Zgjidh Llojin --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-form-unit">Nj√´sia Mat√´se:</label>
                        <select id="product-form-unit" name="unitOfMeasure" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label for="product-form-qty-per-package">Sasia / Paketim (n√´se nj√´sia √´sht√´ paketim):</label>
                        <input type="number" id="product-form-qty-per-package" name="quantityPerPackage" min="1" placeholder="P.sh., 24">
                    </div>
                    <div class="form-group">
                        <label for="product-form-vat-rate">Norma TVSH (%):</label>
                        <input type="number" id="product-form-vat-rate" name="vatRate" min="0" step="any" value="18" required>
                    </div>
                     <div class="form-group">
                        <label for="product-form-purchase-price">√ámimi Blerjes (pa TVSH, Opsional):</label>
                        <input type="number" id="product-form-purchase-price" name="purchasePrice" min="0" step="any" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="product-form-min-stock">Stoku Minimal (Opsional):</label>
                        <input type="number" id="product-form-min-stock" name="minimumStockLevel" min="0" placeholder="P.sh., 10">
                    </div>
                     <div class="form-group">
                        <label for="product-form-primary-supplier">Furnitori Primar (Opsional):</label>
                        <select id="product-form-primary-supplier" name="primarySupplierId" class="form-control">
                            <option value="">-- Zgjidh Furnitorin --</option>
                        </select>
                    </div>
                    <!-- New Recipe Creation section for Final Products -->
                    <div id="product-form-recipe-creation-section" class="form-group-span-3 modal-section" style="display: none; padding-top: 1rem; border-top: 1px dashed #e0e6ed; margin-top: 1rem;">
                        <h3 class="modal-section-title" style="margin-top: 0; font-size: 1.1rem; border: none; padding-bottom: 0.2rem;">Receta e Produktit (BOM)</h3>
                        <div class="form-group">
                            <label for="pfr-recipe-notes">Sh√´nime/Udh√´zime Recete (Opsionale):</label>
                            <textarea id="pfr-recipe-notes" name="recipeNotes" rows="2" class="form-control" style="min-height: 60px;"></textarea>
                        </div>
                        <h4 style="font-size: 1rem; margin-top: 1rem; margin-bottom: 0.5rem; font-weight: 500;">Shto P√´rb√´r√´s</h4>
                        <div class="item-entry-grid" style="grid-template-columns: 3fr 1.5fr auto; align-items: flex-end; gap: 0.75rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="pfr-ingredient-select" style="font-size: 0.85rem;">L√´nda e Par√´:</label>
                                <select id="pfr-ingredient-select" name="pfrIngredient" class="form-control" style="height: 40px; font-size: 0.9rem;"></select>
                            </div>
                            <div class="form-group">
                                <label for="pfr-ingredient-quantity" style="font-size: 0.85rem;">Sasia:</label>
                                <div class="input-with-unit" style="align-items: center;">
                                    <input type="number" id="pfr-ingredient-quantity" name="pfrQuantity" class="form-control" min="0.001" step="any" style="height: 40px; font-size: 0.9rem;">
                                    <input type="text" id="pfr-ingredient-unit" class="form-control readonly-field" style="width: 80px; height: 40px; font-size: 0.9rem;" readonly>
                                </div>
                            </div>
                            <div class="lp-item-actions">
                                <button type="button" id="pfr-add-ingredient-btn" class="btn btn-info" style="height: 40px;">Shto</button>
                            </div>
                        </div>
                        <div class="table-responsive" style="max-height: 200px; margin-top: 1rem;">
                            <table class="admin-table items-table">
                                <thead>
                                    <tr>
                                        <th>Kodi</th>
                                        <th>P√´rb√´r√´si</th>
                                        <th class="text-right">Sasia e Nevojshme</th>
                                        <th>Nj√´sia</th>
                                        <th>Veprim</th>
                                    </tr>
                                </thead>
                                <tbody id="pfr-ingredients-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="product-form-description">P√´rshkrimi (Opsional):</label>
                    <textarea id="product-form-description" name="description" rows="3" placeholder="Detaje shtes√´ rreth produktit..."></textarea>
                </div>
                <div class="form-group">
                    <label for="product-form-image">Ngarko Imazhin e Produktit (Opsional):</label>
                    <input type="file" id="product-form-image" name="imageUrl" accept="image/*" class="form-control-file">
                    <div class="logo-preview-container" style="margin-top: 10px;">
                         <img id="product-form-image-preview" src="#" alt="Pamje paraprake e produktit" class="logo-preview-image" style="max-width: 120px; max-height: 120px;">
                    </div>
                </div>
                 <div class="form-group" style="display: flex; gap: 2rem; align-items: center;">
                    <div class="checkbox-label-inline">
                        <input type="checkbox" id="product-form-is-active" name="isActive" checked>
                        <label for="product-form-is-active">Produkti Aktiv</label>
                    </div>
                    <div class="checkbox-label-inline">
                        <input type="checkbox" id="product-form-is-final-product" name="isFinalProduct">
                        <label for="product-form-is-final-product">Produkt Final</label>
                    </div>
                </div>

                <p id="product-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-product-btn" class="btn btn-primary">Ruaj</button>
                    <button type="button" id="cancel-product-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="category-form-modal" class="modal" style="display: none;">
        <div class="modal-content small-modal-content"> 
            <span class="close-button" id="category-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="category-form-modal-title">Shto Kategori t√´ Re</h2>
            <form id="category-form">
                <input type="hidden" id="edit-category-id" name="editCategoryId">
                <div class="form-group">
                    <label for="category-form-name">Emri i Kategoris√´:</label>
                    <input type="text" id="category-form-name" name="name" required>
                </div>
                <p id="category-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-category-btn" class="btn btn-primary">Ruaj Kategorin√´</button>
                    <button type="button" id="cancel-category-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="item-type-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="item-type-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="item-type-form-modal-title">Shto Lloj t√´ Ri Artikulli</h2>
            <form id="item-type-form">
                <input type="hidden" id="edit-item-type-id" name="editItemTypeId">
                <div class="form-group">
                    <label for="item-type-name-input">Emri i Llojit t√´ Artikullit:</label>
                    <input type="text" id="item-type-name-input" name="name" required>
                </div>
                <div class="form-group">
                    <label for="item-type-description-input">P√´rshkrimi (Opsional):</label>
                    <textarea id="item-type-description-input" name="description" rows="3"></textarea>
                </div>
                <p id="item-type-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-item-type-btn" class="btn btn-primary">Ruaj Llojin e Artikullit</button>
                    <button type="button" id="cancel-item-type-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="deal-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content"> 
            <span class="close-button" id="deal-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="deal-form-modal-title">Shto Ofert√´ t√´ Re</h2>
            <form id="deal-form">
                <input type="hidden" id="edit-deal-id" name="editDealId">
                <div class="form-row-flex">
                    <div class="form-group form-group-flex-item">
                        <label for="deal-form-name">Emri i Ofert√´s:</label>
                        <input type="text" id="deal-form-name" name="name" required>
                    </div>
                    <div class="form-group form-group-flex-item">
                        <label for="deal-form-price">√ámimi i Ofert√´s (‚Ç¨):</label>
                        <input type="number" id="deal-form-price" name="price" min="0" step="any" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="deal-form-description">P√´rshkrimi (Opsional):</label>
                    <textarea id="deal-form-description" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                     <input type="checkbox" id="deal-form-is-active" name="isActive" checked>
                     <label for="deal-form-is-active" class="checkbox-label">Oferta Aktive</label>
                </div>

                <div class="form-group">
                    <h3>Zgjidh Produktet p√´r Ofert√´</h3>
                    <div class="product-search-container modal-search">
                        <span class="search-icon" aria-hidden="true">üîç</span>
                        <input type="search" id="deal-product-search-input-modal" placeholder="K√´rko Produktin...">
                    </div>
                    <div id="deal-form-product-selection" class="modal-product-selection-list">
                        <p class="empty-list-message">Nuk ka produkte p√´r t√´ zgjedhur. Ju lutem shtoni produkte fillimisht.</p>
                    </div>
                </div>
                
                <p id="deal-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-deal-btn" class="btn btn-primary">Ruaj Ofert√´n</button>
                    <button type="button" id="cancel-deal-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <div id="customer-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content"> 
            <span class="close-button" id="customer-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="customer-form-modal-title">Shto Bler√´s t√´ Ri</h2>
            <form id="customer-form">
                <input type="hidden" id="edit-customer-id" name="editCustomerId">
                <div class="form-grid-2-cols">
                    <div class="form-group">
                        <label for="customer-form-code">Kodi i Bler√´sit:</label>
                        <input type="text" id="customer-form-code" name="code" readonly class="readonly-field">
                    </div>
                    <div class="form-group">
                        <label for="customer-form-name">Emri i Plot√´ i Bler√´sit:</label>
                        <input type="text" id="customer-form-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-form-unique-id">Numri Unik (Opsional):</label>
                        <input type="text" id="customer-form-unique-id" name="uniqueId" placeholder="P.sh., NID, ID Card">
                    </div>
                    <div class="form-group">
                        <label for="customer-form-phone">Telefoni (Opsional):</label>
                        <input type="tel" id="customer-form-phone" name="phone" placeholder="P.sh., 06X XXX XXXX">
                    </div>
                </div>
                <div class="form-group">
                    <label for="customer-form-email">Email (Opsional):</label>
                    <input type="email" id="customer-form-email" name="email" placeholder="P.sh., emer@domain.com">
                </div>
                <div class="form-group">
                    <label for="customer-form-address">Adresa (Opsionale):</label>
                    <input type="text" id="customer-form-address" name="address" placeholder="P.sh., Rruga, Qyteti">
                </div>
                <div class="form-group">
                    <label for="customer-form-notes">Sh√´nime (Opsionale):</label>
                    <textarea id="customer-form-notes" name="notes" rows="3" placeholder="Sh√´nime shtes√´ p√´r k√´t√´ bler√´s..."></textarea>
                </div>
                <p id="customer-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-customer-btn" class="btn btn-primary">Ruaj</button>
                    <button type="button" id="cancel-customer-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <div id="supplier-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="supplier-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="supplier-form-modal-title">Shto Furnitor t√´ Ri</h2>
            <form id="supplier-form">
                <input type="hidden" id="edit-supplier-id" name="editSupplierId">
                <div class="form-grid-2-cols">
                     <div class="form-group">
                        <label for="supplier-form-code">Kodi i Furnitorit:</label>
                        <input type="text" id="supplier-form-code" name="code" readonly class="readonly-field">
                    </div>
                    <div class="form-group">
                        <label for="supplier-form-name">Emri i Furnitorit:</label>
                        <input type="text" id="supplier-form-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="supplier-form-contact-person">Personi Kontaktues (Opsional):</label>
                        <input type="text" id="supplier-form-contact-person" name="contactPerson">
                    </div>
                    <div class="form-group">
                        <label for="supplier-form-phone">Telefoni (Opsional):</label>
                        <input type="tel" id="supplier-form-phone" name="phone" placeholder="P.sh., 06X XXX XXXX">
                    </div>
                     <div class="form-group">
                        <label for="supplier-form-nipt">NIPT (Opsional):</label>
                        <input type="text" id="supplier-form-nipt" name="nipt">
                    </div>
                </div>
                <div class="form-group">
                    <label for="supplier-form-email">Email (Opsional):</label>
                    <input type="email" id="supplier-form-email" name="email" placeholder="P.sh., furnitor@domain.com">
                </div>
                <div class="form-group">
                    <label for="supplier-form-address">Adresa (Opsionale):</label>
                    <input type="text" id="supplier-form-address" name="address" placeholder="P.sh., Rruga, Qyteti">
                </div>
                <div class="form-group">
                    <div class="checkbox-label-inline">
                        <input type="checkbox" id="supplier-form-create-as-customer">
                        <label for="supplier-form-create-as-customer">Krijo edhe si Bler√´s</label>
                    </div>
                    <small>N√´se aktivizohet, do t√´ krijohet nj√´ bler√´s me t√´ dh√´na t√´ nj√´jta.</small>
                </div>
                <p id="supplier-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-supplier-btn" class="btn btn-primary">Ruaj Furnitorin</button>
                    <button type="button" id="cancel-supplier-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="employee-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="employee-form-modal-close-btn">&times;</span>
            <h2 id="employee-form-modal-title">Shto Punonj√´s t√´ Ri</h2>
            <form id="employee-form">
                <input type="hidden" id="edit-employee-id">
                
                <h3 class="modal-section-title">Informacion Personal</h3>
                <div class="form-grid-3-cols">
                    <div class="form-group">
                        <label for="employee-first-name">Emri:</label>
                        <input type="text" id="employee-first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-last-name">Mbiemri:</label>
                        <input type="text" id="employee-last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-personal-id">Numri Personal:</label>
                        <input type="text" id="employee-personal-id" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-dob">Dat√´lindja:</label>
                        <input type="date" id="employee-dob" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-gender">Gjinia:</label>
                        <select id="employee-gender" required>
                            <option value="Mashkull">Mashkull</option>
                            <option value="Femer">Femer</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="employee-phone">Telefoni:</label>
                        <input type="tel" id="employee-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-email">Email:</label>
                        <input type="email" id="employee-email">
                    </div>
                    <div class="form-group">
                        <label for="employee-city">Qyteti:</label>
                        <input type="text" id="employee-city">
                    </div>
                    <div class="form-group form-group-span-2">
                        <label for="employee-address">Adresa:</label>
                        <input type="text" id="employee-address">
                    </div>
                </div>

                <h3 class="modal-section-title">Informacion Pun√´simi</h3>
                <div class="form-grid-3-cols">
                    <div class="form-group">
                        <label for="employee-position">Pozicioni:</label>
                        <input type="text" id="employee-position" required>
                    </div>
                    <div class="form-group">
                        <label for="employee-department">Departamenti:</label>
                        <input type="text" id="employee-department">
                    </div>
                    <div class="form-group">
                        <label for="employee-date-of-hire">Data e Pun√´simit:</label>
                        <input type="date" id="employee-date-of-hire" required>
                    </div>
                     <div class="form-group">
                        <label for="employee-contract-type">Lloji i Kontrat√´s:</label>
                        <select id="employee-contract-type" required>
                            <option value="I plot√´">I plot√´</option>
                            <option value="I pjessh√´m">I pjessh√´m</option>
                            <option value="Praktikant">Praktikant</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="employee-salary">Paga Baz√´ Bruto (‚Ç¨):</label>
                        <input type="number" id="employee-salary" min="0" step="any">
                    </div>
                     <div class="form-group">
                        <label for="employee-status">Statusi i Pun√´simit:</label>
                        <select id="employee-status" required>
                            <option value="Aktiv">Aktiv</option>
                            <option value="Joaktiv">Joaktiv</option>
                            <option value="Me leje">Me leje</option>
                        </select>
                    </div>
                </div>

                <h3 class="modal-section-title">Struktura e Pag√´s</h3>
                <div id="employee-salary-structure-section" class="form-grid-2-cols">
                    <div class="form-group form-group-span-1">
                        <h4>Shtesa Periodike</h4>
                        <div id="employee-recurring-additions-container" class="salary-structure-items-list">
                            <p>Nuk ka shtesa.</p>
                        </div>
                        <div class="item-entry-grid" style="grid-template-columns: 2fr 1fr auto; margin-top: 1rem; align-items:flex-end;">
                            <div class="form-group">
                                <label for="new-addition-desc" style="font-size: 0.85rem;">P√´rshkrimi i Shtes√´s:</label>
                                <input type="text" id="new-addition-desc" class="form-control" style="height: 40px; font-size: 0.9rem;">
                            </div>
                            <div class="form-group">
                                <label for="new-addition-amount" style="font-size: 0.85rem;">Shuma (‚Ç¨):</label>
                                <input type="number" id="new-addition-amount" class="form-control" style="height: 40px; font-size: 0.9rem;" min="0" step="any">
                            </div>
                            <div class="lp-item-actions">
                                <button type="button" id="add-recurring-addition-btn" class="btn btn-info" style="height: 40px;">Shto</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group form-group-span-1">
                        <h4>Zbritje Periodike</h4>
                        <div id="employee-recurring-deductions-container" class="salary-structure-items-list">
                            <p>Nuk ka zbritje.</p>
                        </div>
                         <div class="item-entry-grid" style="grid-template-columns: 2fr 1fr auto; margin-top: 1rem; align-items:flex-end;">
                            <div class="form-group">
                                <label for="new-deduction-desc" style="font-size: 0.85rem;">P√´rshkrimi i Zbritjes:</label>
                                <input type="text" id="new-deduction-desc" class="form-control" style="height: 40px; font-size: 0.9rem;">
                            </div>
                            <div class="form-group">
                                <label for="new-deduction-amount" style="font-size: 0.85rem;">Shuma (‚Ç¨):</label>
                                <input type="number" id="new-deduction-amount" class="form-control" style="height: 40px; font-size: 0.9rem;" min="0" step="any">
                            </div>
                            <div class="lp-item-actions">
                                <button type="button" id="add-recurring-deduction-btn" class="btn btn-info" style="height: 40px;">Shto</button>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="modal-section-title">Llogaria e Sistemit</h3>
                 <div class="form-group">
                    <label for="employee-linked-user">Lidh me P√´rdoruesin e Sistemit (Opsionale):</label>
                    <select id="employee-linked-user">
                        <option value="">-- Asnj√´ --</option>
                    </select>
                    <small>Lidh k√´t√´ punonj√´s me nj√´ llogari ekzistuese Menaxher/Shit√´s.</small>
                </div>

                <h3 class="modal-section-title">Dokumentet Personale</h3>
                <div class="form-group form-grid-2-cols" style="align-items: flex-end;">
                    <div>
                        <label for="employee-document-upload">Ngarko Dokument:</label>
                        <input type="file" id="employee-document-upload" class="form-control-file">
                    </div>
                    <button type="button" id="upload-employee-document-btn" class="btn btn-info">Shto Dokument</button>
                </div>
                <div class="table-responsive" style="max-height: 200px;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Emri i Skedarit</th>
                                <th>Lloji</th>
                                <th>Ngarkuar M√´</th>
                                <th>Veprime</th>
                            </tr>
                        </thead>
                        <tbody id="employee-documents-tbody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <h3 class="modal-section-title">Historiku i Pozicioneve</h3>
                <div class="form-actions-group" style="justify-content: flex-start; margin-top: 0; margin-bottom: 1rem;">
                    <button type="button" id="show-change-position-modal-btn" class="btn btn-secondary">Ndrysho Pozicionin</button>
                </div>
                 <div class="table-responsive" style="max-height: 200px;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Pozicioni</th>
                                <th>Departamenti</th>
                                <th>Data Fillimit</th>
                                <th>Data Mbarimit</th>
                            </tr>
                        </thead>
                        <tbody id="employee-position-history-tbody">
                             <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <p id="employee-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-employee-btn" class="btn btn-primary">Ruaj Punonj√´sin</button>
                    <button type="button" id="cancel-employee-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="employee-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="employee-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="employee-details-modal-title">Detajet e Punonj√´sit</h2>
            <div id="employee-details-content">
                <!-- Content will be populated by JS -->
            </div>
            <div class="modal-actions">
                <button type="button" id="employee-details-close-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>
    
    <div id="change-position-modal" class="modal no-print" style="display: none;">
        <div class="modal-content small-modal-content">
            <span class="close-button" id="change-position-modal-close-btn">&times;</span>
            <h2 id="change-position-modal-title">Ndrysho Pozicionin e Punonj√´sit</h2>
            <form id="change-position-form">
                <input type="hidden" id="change-position-employee-id">
                <div class="form-group">
                    <label for="change-position-new-position">Pozicioni i Ri:</label>
                    <input type="text" id="change-position-new-position" class="form-control" required>
                </div>
                 <div class="form-group">
                    <label for="change-position-new-department">Departamenti i Ri:</label>
                    <input type="text" id="change-position-new-department" class="form-control">
                </div>
                <div class="form-group">
                    <label for="change-position-start-date">Data e Fillimit n√´ Pozicionin e Ri:</label>
                    <input type="date" id="change-position-start-date" class="form-control" required>
                </div>
                <p id="change-position-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-position-change-btn" class="btn btn-primary">Ruaj Ndryshimin</button>
                    <button type="button" id="cancel-position-change-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- HR Modals -->
    <div id="manual-time-entry-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="manual-time-entry-modal-close-btn">&times;</span>
            <h2>Regjistrim Manual i Hyrje/Daljes</h2>
            <form id="manual-time-entry-form">
                <div class="form-group">
                    <label for="mte-employee-select">Zgjidh Punonj√´sin:</label>
                    <select id="mte-employee-select" name="employeeId" required></select>
                </div>
                <div class="form-group">
                    <label>Lloji i Regjistrimit:</label>
                    <div class="radio-group">
                        <input type="radio" id="mte-type-in" name="entryType" value="in" checked>
                        <label for="mte-type-in">Hyrje (Clock-in)</label>
                        <input type="radio" id="mte-type-out" name="entryType" value="out">
                        <label for="mte-type-out">Dalje (Clock-out)</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="mte-datetime-input">Data dhe Ora:</label>
                    <input type="datetime-local" id="mte-datetime-input" name="timestamp" required>
                </div>
                <div class="form-group">
                    <label for="mte-notes-input">Sh√´nime (Opsionale):</label>
                    <textarea id="mte-notes-input" name="notes" rows="2"></textarea>
                </div>
                <p id="manual-time-entry-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Ruaj Regjistrimin</button>
                    <button type="button" class="btn btn-secondary" id="manual-time-entry-cancel-btn">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <div id="qr-code-scanner-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="qr-code-scanner-modal-close-btn">&times;</span>
            <h2>Skano Kodin QR</h2>
            <div class="info-message info">Funksionaliteti i skanimit me QR Kod do t√´ jet√´ i disponuesh√´m s√´ shpejti. Kjo do t√´ lejoj√´ regjistrim t√´ shpejt√´ t√´ hyrje/daljeve duke p√´rdorur kamer√´n e pajisjes.</div>
            <!-- Placeholder for camera view -->
            <div id="qr-video-container" style="background: #000; min-height: 250px; margin-top:1rem; border-radius: 8px;"></div>
        </div>
    </div>

    <div id="leave-request-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="leave-request-modal-close-btn">&times;</span>
            <h2 id="leave-request-form-title">K√´rkes√´ e Re p√´r Pushim</h2>
            <form id="leave-request-form">
                <div class="form-group">
                    <label for="lr-employee-select">Punonj√´si:</label>
                    <select id="lr-employee-select" required></select>
                </div>
                <div class="form-group">
                    <label for="lr-leave-type-select">Lloji i Pushimit:</label>
                    <select id="lr-leave-type-select" required>
                        <option value="Vjetor">Pushim Vjetor</option>
                        <option value="Mjek√´sor">Pushim Mjek√´sor</option>
                        <option value="Pa Pages√´">Pushim pa Pages√´</option>
                        <option value="Tjet√´r">Tjet√´r</option>
                    </select>
                </div>
                <div class="form-grid-2-cols">
                    <div class="form-group">
                        <label for="lr-start-date">Data e Fillimit:</label>
                        <input type="date" id="lr-start-date" required>
                    </div>
                    <div class="form-group">
                        <label for="lr-end-date">Data e Mbarimit:</label>
                        <input type="date" id="lr-end-date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="lr-reason-textarea">Arsyeja (Opsionale):</label>
                    <textarea id="lr-reason-textarea" rows="3"></textarea>
                </div>
                <p id="leave-request-form-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">D√´rgo K√´rkes√´n</button>
                    <button type="button" class="btn btn-secondary" id="leave-request-cancel-btn">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="overtime-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="overtime-modal-close-btn">&times;</span>
            <h2 id="overtime-form-title">Regjistro Or√´ Shtes√´</h2>
            <form id="overtime-form">
                <div class="form-group">
                    <label for="ot-employee-select">Punonj√´si:</label>
                    <select id="ot-employee-select" required></select>
                </div>
                <div class="form-group">
                    <label for="ot-date">Data:</label>
                    <input type="date" id="ot-date" required>
                </div>
                 <div class="form-group">
                    <label for="ot-hours">Numri i Or√´ve:</label>
                    <input type="number" id="ot-hours" min="0.5" step="0.5" required>
                </div>
                <div class="form-group">
                    <label for="ot-reason-textarea">Arsyeja:</label>
                    <textarea id="ot-reason-textarea" rows="3" required></textarea>
                </div>
                <p id="overtime-form-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Ruaj Or√´t Shtes√´</button>
                    <button type="button" class="btn btn-secondary" id="overtime-cancel-btn">Anulo</button>
                </div>
            </form>
        </div>
    </div>


    <div id="local-purchase-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="lp-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Detajet e Blerjes Vendore</h2>
            
            <div id="lp-details-printable-content" class="printable-area">
                <div class="modal-section">
                    <h3 class="modal-section-title">Informacioni i Fatur√´s</h3>
                    <div class="form-grid-2-cols">
                        <div class="form-group info-field"><label>Furnitori:</label> <span id="lp-details-supplier-name"></span></div>
                        <div class="form-group info-field"><label>Nr. Fatur√´s (Sistem):</label> <span id="lp-details-system-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Nr. Fatur√´s (Furnitor):</label> <span id="lp-details-supplier-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Data e Fatur√´s:</label> <span id="lp-details-invoice-date"></span></div>
                        <div class="form-group info-field"><label>Data e Pranimit:</label> <span id="lp-details-receipt-date"></span></div>
                        <div class="form-group info-field"><label>Statusi Pages√´s:</label> <span id="lp-details-payment-status"></span></div>
                        <div class="form-group info-field"><label>Shuma Paguar:</label> <span id="lp-details-amount-paid" class="cash-value"></span></div>
                    </div>
                </div>

                <div class="modal-section table-section">
                    <h3 class="modal-section-title">Artikujt e Fatur√´s</h3>
                    <div class="table-responsive">
                        <table class="admin-table items-table">
                            <thead>
                                <tr>
                                    <th>Kodi</th>
                                    <th>Em√´rtimi</th>
                                    <th>Sasia</th>
                                    <th class="text-right">√ám. Nj√´sie (pa TVSH)</th>
                                    <th class="text-right">TVSH (%)</th>
                                    <th class="text-right">√ám. Nj√´sie (me TVSH)</th>
                                    <th class="text-right">Vlera Tot. (pa TVSH)</th>
                                    <th class="text-right">Vlera Tot. (me TVSH)</th>
                                </tr>
                            </thead>
                            <tbody id="lp-details-items-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-section summary-section">
                    <h3 class="modal-section-title">P√´rmbledhja Financiare</h3>
                    <div class="sale-summary">
                        <div class="summary-row">
                            <span>N√´ntotali (pa TVSH):</span>
                            <span id="lp-details-total-without-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row">
                            <span>Vlera e TVSH-s√´:</span>
                            <span id="lp-details-total-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row total-row">
                            <span><strong>TOTALI (me TVSH):</strong></span>
                            <span id="lp-details-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" id="lp-details-print-invoice-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp Fatur√´n</button>
                <button type="button" id="lp-details-close-modal-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>
    
    <div id="return-purchase-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="rp-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Detajet e Kthimit t√´ Blerjes</h2>
             <div id="rp-details-printable-content" class="printable-area">
                <div class="modal-section">
                    <h3 class="modal-section-title">Informacioni i Fatur√´s s√´ Kthimit</h3>
                    <div class="form-grid-2-cols">
                        <div class="form-group info-field"><label>Furnitori:</label> <span id="rp-details-supplier-name"></span></div>
                        <div class="form-group info-field"><label>Nr. Fatur√´s Kthimit (Sistem):</label> <span id="rp-details-system-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Nr. Fatur√´s (Furnitor, Ref.):</label> <span id="rp-details-supplier-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Data e Kthimit:</label> <span id="rp-details-invoice-date"></span></div>
                        <div class="form-group info-field"><label>Arsyeja:</label> <span id="rp-details-reason"></span></div>
                    </div>
                </div>
                <div class="modal-section table-section">
                    <h3 class="modal-section-title">Artikujt e Kthyer</h3>
                    <div class="table-responsive">
                        <table class="admin-table items-table">
                            <thead>
                                <tr>
                                    <th>Kodi</th>
                                    <th>Em√´rtimi</th>
                                    <th>Sasia e Kthyer</th>
                                    <th class="text-right">√ám. Kthimit (pa TVSH)</th>
                                    <th class="text-right">TVSH (%)</th>
                                    <th class="text-right">√ám. Kthimit (me TVSH)</th>
                                    <th class="text-right">Vlera Tot. Kthimit (pa TVSH)</th>
                                    <th class="text-right">Vlera Tot. Kthimit (me TVSH)</th>
                                </tr>
                            </thead>
                            <tbody id="rp-details-items-tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-section summary-section">
                    <h3 class="modal-section-title">P√´rmbledhja Financiare e Kthimit</h3>
                    <div class="sale-summary">
                        <div class="summary-row">
                            <span>N√´ntotali Kthimit (pa TVSH):</span>
                            <span id="rp-details-total-without-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row">
                            <span>Vlera e TVSH-s√´ (Kthim):</span>
                            <span id="rp-details-total-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row total-row">
                            <span><strong>TOTALI KTHIMIT (me TVSH):</strong></span>
                            <span id="rp-details-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="rp-details-print-invoice-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp Fatur√´n e Kthimit</button>
                <button type="button" id="rp-details-close-modal-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>

    <div id="sales-return-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="sr-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Detajet e Kthimit t√´ Shitjes</h2>
            <div id="sr-details-printable-content" class="printable-area">
                <div class="modal-section">
                    <h3 class="modal-section-title">Informacioni i Fatur√´s s√´ Kthimit</h3>
                    <div class="form-grid-2-cols">
                        <div class="form-group info-field"><label>ID Kthimi (Sistem):</label> <span id="sr-details-system-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Nr. Fatur√´s Origjinale:</label> <span id="sr-details-original-invoice-number"></span></div>
                        <div class="form-group info-field"><label>Bler√´si:</label> <span id="sr-details-customer-name"></span></div>
                        <div class="form-group info-field"><label>Data e Kthimit:</label> <span id="sr-details-return-date"></span></div>
                        <div class="form-group info-field" style="grid-column: 1 / -1;"><label>Arsyeja:</label> <span id="sr-details-reason"></span></div>
                    </div>
                </div>
                <div class="modal-section table-section">
                    <h3 class="modal-section-title">Artikujt e Kthyer</h3>
                    <div class="table-responsive">
                        <table class="admin-table items-table">
                            <thead>
                                <tr>
                                    <th>Kodi</th>
                                    <th>Em√´rtimi</th>
                                    <th class="text-right">Sasia e Kthyer</th>
                                    <th class="text-right">√ám. Kthimit (pa TVSH)</th>
                                    <th class="text-right">TVSH (%)</th>
                                    <th class="text-right">√ám. Kthimit (me TVSH)</th>
                                    <th class="text-right">Vlera Tot. Kthimit</th>
                                </tr>
                            </thead>
                            <tbody id="sr-details-items-tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-section summary-section">
                    <h3 class="modal-section-title">P√´rmbledhja Financiare e Kthimit</h3>
                    <div class="sale-summary">
                        <div class="summary-row">
                            <span>N√´ntotali Kthimit (pa TVSH):</span>
                            <span id="sr-details-total-without-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row">
                            <span>Vlera e TVSH-s√´ (Kthim):</span>
                            <span id="sr-details-total-vat">0.00 ‚Ç¨</span>
                        </div>
                        <div class="summary-row total-row">
                            <span><strong>TOTALI KTHIMIT (me TVSH):</strong></span>
                            <span id="sr-details-total-with-vat"><strong>0.00 ‚Ç¨</strong></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="sr-details-print-invoice-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp Fatur√´n e Kthimit</button>
                <button type="button" id="sr-details-close-modal-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>

    <!-- Credit Note Form Modal -->
    <div id="credit-note-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="credit-note-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="credit-note-form-modal-title">Shto Note Krediti</h2>
            <form id="credit-note-form">
                <input type="hidden" id="edit-credit-note-id">
                <div class="form-group">
                    <label for="cn-system-id">ID Note Krediti (Sistem):</label>
                    <input type="text" id="cn-system-id" name="systemCreditNoteId" readonly class="readonly-field form-control">
                </div>
                <div class="form-group">
                    <label for="cn-customer-search-input">Bler√´si:</label>
                     <div class="custom-select-wrapper">
                        <input type="text" id="cn-customer-search-input" name="customerSearch" placeholder="K√´rko Bler√´sin..." class="form-control" required>
                        <div id="cn-customer-dropdown-panel" class="custom-dropdown-panel" style="display: none;"></div>
                    </div>
                    <input type="hidden" id="cn-selected-customer-id" name="selectedCustomerId">
                </div>
                <div class="form-group">
                    <label for="cn-date">Data e Not√´s s√´ Kreditit:</label>
                    <input type="date" id="cn-date" name="creditNoteDate" required class="form-control">
                </div>
                <div class="form-group">
                    <label for="cn-total-amount">Shuma Totale e Kreditimit (‚Ç¨):</label>
                    <input type="number" id="cn-total-amount" name="totalAmount" required class="form-control" min="0.01" step="any" placeholder="0.00">
                </div>
                 <div class="form-group">
                    <label for="cn-linked-invoice-id">Fatura e Lidhur (Opsionale):</label>
                    <input type="text" id="cn-linked-invoice-id" name="linkedInvoiceId" class="form-control" placeholder="Nr. fatur√´s origjinale">
                </div>
                <div class="form-group">
                    <label for="cn-reason">Arsyeja/P√´rshkrimi:</label>
                    <textarea id="cn-reason" name="reason" rows="3" required class="form-control" placeholder="Arsyeja e l√´shimit t√´ not√´s s√´ kreditit..."></textarea>
                </div>
                <p id="credit-note-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-credit-note-btn" class="btn btn-primary">Ruaj Not√´n e Kreditit</button>
                    <button type="button" id="cancel-credit-note-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Debit Note Form Modal -->
    <div id="debit-note-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="debit-note-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="debit-note-form-modal-title">Shto Note Debiti</h2>
            <form id="debit-note-form">
                <input type="hidden" id="edit-debit-note-id">
                <div class="form-group">
                    <label for="dn-system-id">ID Note Debiti (Sistem):</label>
                    <input type="text" id="dn-system-id" name="systemDebitNoteId" readonly class="readonly-field form-control">
                </div>
                 <div class="form-group">
                    <label for="dn-supplier-select">Furnitori:</label>
                    <select id="dn-supplier-select" name="supplierId" class="form-control" required>
                        <option value="">-- Zgjidh Furnitorin --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="dn-date">Data e Not√´s s√´ Debitit:</label>
                    <input type="date" id="dn-date" name="debitNoteDate" required class="form-control">
                </div>
                <div class="form-group">
                    <label for="dn-total-amount">Shuma Totale e Debitimit (‚Ç¨):</label>
                    <input type="number" id="dn-total-amount" name="totalAmount" required class="form-control" min="0.01" step="any" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="dn-linked-invoice-id">Fatura e Lidhur (Opsionale):</label>
                    <input type="text" id="dn-linked-invoice-id" name="linkedInvoiceId" class="form-control" placeholder="Nr. fatur√´s origjinale t√´ blerjes">
                </div>
                <div class="form-group">
                    <label for="dn-reason">Arsyeja/P√´rshkrimi:</label>
                    <textarea id="dn-reason" name="reason" rows="3" required class="form-control" placeholder="Arsyeja e l√´shimit t√´ not√´s s√´ debitit..."></textarea>
                </div>
                <p id="debit-note-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-debit-note-btn" class="btn btn-primary">Ruaj Not√´n e Debitit</button>
                    <button type="button" id="cancel-debit-note-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>


    <div id="outgoing-payment-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="op-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Detajet e Pages√´s Dal√´se</h2>
             <div id="op-details-printable-content" class="printable-area">
                <div class="modal-section">
                    <h3 class="modal-section-title">Informacioni i Pages√´s</h3>
                    <div class="form-grid-2-cols">
                        <div class="form-group info-field"><label>ID Pages√´s (Sistem):</label> <span id="op-details-payment-id"></span></div>
                        <div class="form-group info-field"><label>Furnitori:</label> <span id="op-details-supplier-name"></span></div>
                        <div class="form-group info-field"><label>Data e Pages√´s:</label> <span id="op-details-payment-date"></span></div>
                        <div class="form-group info-field"><label>Shuma Totale e Paguar:</label> <strong id="op-details-total-paid-amount" class="cash-value"></strong></div>
                        <div class="form-group info-field"><label>M√´nyra e Pages√´s:</label> <span id="op-details-payment-method"></span></div>
                        <div class="form-group info-field"><label>Referenca:</label> <span id="op-details-reference"></span></div>
                    </div>
                     <div class="form-group info-field" style="grid-column: 1 / -1;"><label>Sh√´nime:</label> <span id="op-details-notes" style="white-space: pre-wrap;"></span></div>
                </div>

                <div class="modal-section table-section">
                    <h3 class="modal-section-title">Faturat e Alokuara</h3>
                    <div class="table-responsive">
                        <table class="admin-table items-table">
                            <thead>
                                <tr>
                                    <th>Nr. Fatur√´s (Sistem)</th>
                                    <th>Nr. Fatur√´s (Furnitor)</th>
                                    <th>Data Fatur√´s</th>
                                    <th class="text-right">Shuma e Alokuar (‚Ç¨)</th>
                                </tr>
                            </thead>
                            <tbody id="op-details-allocations-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="op-details-print-payment-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp D√´ftes√´n e Pages√´s</button>
                <button type="button" id="op-details-close-modal-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>


    <div id="payment-modal" class="modal" style="display: none;">
        <div class="modal-content payment-modal-content">
            <span class="close-button" id="payment-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="payment-modal-title" class="payment-modal-header-title">Pagesa e Shitjes</h2>
            
            <div class="payment-section total-due-section">
                <label>Totali p√´r t√´ paguar:</label>
                <span id="payment-modal-total-amount-display" class="payment-total-display">0.00 ‚Ç¨</span>
            </div>

            <div class="payment-section amount-received-section">
                <label for="payment-amount-received">Sasia e Marr√´ (‚Ç¨):</label>
                <input type="number" id="payment-amount-received" name="amountReceived" min="0" step="any" required>
            </div>
            
            <div id="quick-pay-buttons-container" class="quick-pay-buttons"></div>

            <div class="payment-section change-due-section">
                <label>Kusuri Juaj:</label>
                <span id="payment-modal-change-amount-display" class="payment-change-display">0.00 ‚Ç¨</span>
            </div>
            
            <p id="payment-modal-error" class="error-message" aria-live="polite"></p>
            
            <div class="modal-actions payment-modal-actions">
                <button type="button" id="confirm-payment-btn" class="btn btn-success btn-payment-action">
                    <span class="icon-confirm">‚úì</span> Konfirmo Pages√´n
                </button>
                <button type="button" id="cancel-payment-btn" class="btn btn-secondary btn-payment-action">
                    <span class="icon-cancel">‚úï</span> Anulo
                </button>
            </div>
        </div>
    </div>

    <div id="reconciliation-modal" class="modal" style="display: none;">
        <div class="modal-content reconciliation-modal-content-enhanced">
            <span class="close-button" id="reconciliation-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="reconciliation-modal-title" class="reconciliation-main-title">
                <span class="reconciliation-title-icon" aria-hidden="true">‚öñÔ∏è</span> Mbyllja dhe Barazimi i Ark√´s
            </h2>
            <form id="reconciliation-form">
                <div class="reconciliation-section" id="reconciliation-seller-select-section">
                    <h3 class="reconciliation-section-title">1. Zgjidh Nd√´rrimin p√´r Barazim</h3>
                    <div class="form-group">
                        <label for="select-seller-for-reconciliation">Shit√´si & Nd√´rrimi:</label>
                        <select id="select-seller-for-reconciliation" name="sellerForReconciliation" required class="form-control">
                            <option value="">-- Zgjidh Shit√´sin & Nd√´rrimin --</option>
                        </select>
                    </div>
                </div>

                <div id="reconciliation-details-view" style="display: none;">
                    <div class="reconciliation-main-content-wrapper">
                        <div class="reconciliation-section" id="reconciliation-system-summary-section">
                            <h3 class="reconciliation-section-title">2. P√´rmbledhja e Nd√´rrimit (Sipas Sistemit)</h3>
                            <div class="reconciliation-info-grid">
                                <p><span class="label">Shit√´si:</span> <strong id="reconciliation-seller-username">N/A</strong></p>
                                <p><span class="label">Data e Ark√´s:</span> <strong id="reconciliation-entry-date">N/A</strong></p>
                                <p><span class="label">Nd√´rrimi:</span> <strong id="reconciliation-entry-shift">N/A</strong></p>
                                <p><span class="label">Arka Fillestare:</span> <strong id="reconciliation-initial-cash" class="cash-value">0.00 ‚Ç¨</strong></p>
                                <p><span class="label">Totali i Shitjeve (Sistem):</span> <strong id="reconciliation-system-sales" class="cash-value">0.00 ‚Ç¨</strong></p>
                                <p id="reconciliation-petty-cash-row" style="display: none;"><span class="label">Shpenzime (Petty Cash):</span> <strong id="reconciliation-petty-cash" class="cash-value negative">0.00 ‚Ç¨</strong></p>
                                <p class="expected-cash-label"><span class="label">Gjendja e Pritshme (Sistem):</span> <strong id="reconciliation-expected-cash" class="cash-value emphasis">0.00 ‚Ç¨</strong></p>
                            </div>
                            <div id="zero-sales-reconciliation-notice" class="zero-sales-notice" style="display: none;">
                                <input type="checkbox" id="confirm-zero-sales-closure" name="confirmZeroSales" aria-labelledby="zero-sales-closure-label">
                                <label for="confirm-zero-sales-closure" id="zero-sales-closure-label">Konfirmoj mbylljen e k√´tij nd√´rrimi me 0.00‚Ç¨ shitje.</label>
                            </div>
                        </div>

                        <div class="reconciliation-section" id="reconciliation-physical-count-section">
                            <h3 class="reconciliation-section-title">3. Num√´rimi Fizik i Parave</h3>
                            <div class="form-group">
                                <label for="reconciliation-actual-cash-counted">Sasia e Num√´ruar Fizikisht (‚Ç¨):</label>
                                <div class="input-with-symbol">
                                    <input type="number" id="reconciliation-actual-cash-counted" name="actualCashCounted" min="0" step="any" required placeholder="0.00">
                                    <span class="input-symbol">‚Ç¨</span>
                                </div>
                            </div>
                            <div id="reconciliation-quick-cash-buttons-container" class="quick-cash-buttons-reconciliation"></div>
                        </div>
                    </div>
                    
                    <div class="reconciliation-section" id="reconciliation-difference-section">
                        <h3 class="reconciliation-section-title">4. Diferenca</h3>
                         <p class="difference-display">
                            <span class="label">Diferenca:</span>
                            <strong id="reconciliation-difference" class="cash-value difference-value">0.00 ‚Ç¨</strong>
                            <span id="reconciliation-difference-icon" class="difference-icon"></span>
                        </p>
                    </div>
                </div>
                 <p id="reconciliation-modal-error" class="error-message"></p>
                <div class="reconciliation-modal-actions">
                    <button type="submit" id="confirm-reconciliation-btn" class="btn btn-primary btn-reconciliation-action" disabled>
                        Konfirmo Barazimin
                    </button>
                    <button type="button" id="cancel-reconciliation-btn" class="btn btn-secondary btn-reconciliation-action">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Change PIN Modal -->
    <div id="change-clear-sale-pin-modal" class="modal" style="display: none;">
        <div class="modal-content small-modal-content">
            <span class="close-button" id="change-clear-sale-pin-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="change-clear-sale-pin-modal-title">Ndrysho PIN-in e Pastrimit t√´ Shitjes</h2>
            <form id="change-clear-sale-pin-form">
                <div class="form-group" id="current-clear-sale-pin-group">
                    <label for="current-clear-sale-pin-input">PIN Aktual:</label>
                    <input type="password" id="current-clear-sale-pin-input" name="currentPin" required>
                </div>
                <div class="form-group">
                    <label for="new-clear-sale-pin-input">PIN i Ri (3-6 shifra):</label>
                    <input type="password" id="new-clear-sale-pin-input" name="newPin" required pattern="[0-9]{3,6}" title="PIN-i duhet t√´ jet√´ midis 3 dhe 6 shifrave.">
                </div>
                <div class="form-group">
                    <label for="confirm-new-clear-sale-pin-input">Konfirmo PIN-in e Ri:</label>
                    <input type="password" id="confirm-new-clear-sale-pin-input" name="confirmNewPin" required>
                </div>
                <p id="change-clear-sale-pin-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-clear-sale-pin-btn" class="btn btn-primary">Ruaj PIN-in</button>
                    <button type="button" id="cancel-change-clear-sale-pin-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Confirm Clear Sale Modal -->
    <div id="clear-sale-confirmation-modal" class="modal" style="display: none;">
        <div class="modal-content small-modal-content">
            <span class="close-button" id="clear-sale-confirmation-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="clear-sale-confirmation-modal-title">Konfirmo Pastrimin e Shitjes</h2>
            <p>P√´r t√´ pastruar shitjen aktuale, ju lutem futni PIN-in e menaxherit.</p>
            <form id="clear-sale-confirmation-form">
                <div class="form-group">
                    <label for="clear-sale-pin-input">PIN:</label>
                    <input type="password" id="clear-sale-pin-input" name="pin" required>
                </div>
                <p id="clear-sale-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="button" id="confirm-clear-sale-with-pin-btn" class="btn btn-primary">Konfirmo</button>
                    <button type="button" id="cancel-clear-sale-confirmation-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Seller Shift Sales Modal -->
    <div id="seller-shift-sales-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="seller-shift-sales-modal-close-btn">&times;</span>
            <h2 id="seller-shift-sales-modal-title">Shitjet e Nd√´rrimit</h2>
            <div id="seller-shift-sales-content" class="table-responsive">
                <!-- Sales content will be populated here -->
            </div>
            <div class="modal-actions">
                <button type="button" id="print-seller-shift-sales-btn" class="btn btn-primary">Shtyp</button>
                <button type="button" id="close-seller-shift-sales-modal-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>

    <!-- Super Admin Add Business Modal -->
    <div id="add-business-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="add-business-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="add-business-modal-title">Shto Biznes t√´ Ri</h2>
            <form id="add-business-form">
                <div class="form-group">
                    <label for="add-business-name-input">Emri i Biznesit:</label>
                    <input type="text" id="add-business-name-input" name="name" required>
                </div>
                 <div class="form-group">
                    <label for="add-business-logo-input">Logo e Biznesit (Opsionale):</label>
                    <input type="file" id="add-business-logo-input" name="logo" accept="image/*" class="form-control-file">
                    <div class="logo-preview-container">
                        <img id="add-business-logo-preview" src="#" alt="Pamje paraprake e logos" class="logo-preview-image">
                    </div>
                </div>
                <div class="form-group">
                    <h3>Zgjidh Pakon e Abonimit</h3>
                    <div id="subscription-package-selection" class="subscription-package-container">
                       <p class="info-message secondary">Nuk ka paketa t√´ konfiguruara. Shto paketa nga paneli i menaxhimit t√´ paketave.</p>
                    </div>
                    <input type="hidden" id="selected-subscription-package-id">
                </div>
                <p id="add-business-form-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-new-business-btn" class="btn btn-primary">Ruaj Biznesin</button>
                    <button type="button" id="cancel-add-business-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Super Admin Subscription Package Form Modal -->
    <div id="subscription-package-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="subscription-package-form-modal-close-btn">&times;</span>
            <h2 id="subscription-package-form-modal-title">Menaxho Paket√´n e Abonimit</h2>
            <form id="subscription-package-form">
                <input type="hidden" id="edit-package-id">
                 <div class="form-grid-3-cols">
                    <div class="form-group">
                        <label for="package-form-id">ID e Pakos:</label>
                        <input type="text" id="package-form-id" name="packageId" required>
                    </div>
                    <div class="form-group">
                        <label for="package-form-name">Emri i Pakos:</label>
                        <input type="text" id="package-form-name" name="packageName" required>
                    </div>
                    <div class="form-group">
                        <label for="package-form-price">√ámimi (‚Ç¨):</label>
                        <input type="number" id="package-form-price" name="price" min="0" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="package-form-duration">Koh√´zgjatja (Vite):</label>
                        <input type="number" id="package-form-duration" name="durationYears" min="1" step="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="package-form-features">Ve√ßorit√´ (nj√´ p√´r rresht):</label>
                    <textarea id="package-form-features" name="features" rows="5"></textarea>
                </div>

                <div class="form-group">
                    <h3>Lejet e Pakos</h3>
                    <p class="info-message secondary">Lejet e zgjedhura k√´tu do t√´ p√´rcaktojn√´ cilat pamje mund t√´ aksesoj√´ nj√´ menaxher i nj√´ biznesi me k√´t√´ pako. Ve√ßorit√´ e listuara m√´ sip√´r duhet t√´ korrespondojn√´ me k√´to leje.</p>
                    <div id="package-permissions-container" class="package-permissions-grid">
                        <p class="loading-message">Duke ngarkuar lejet...</p>
                    </div>
                </div>

                <p id="package-form-error" class="error-message"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-package-btn" class="btn btn-primary">Ruaj Paket√´n</button>
                    <button type="button" id="cancel-package-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Account Form Modal -->
    <div id="account-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="account-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="account-form-modal-title">Shto Llogari t√´ Re</h2>
            <form id="account-form">
                <input type="hidden" id="edit-account-id" name="editAccountId">
                <div class="form-grid-2-cols">
                    <div class="form-group">
                        <label for="account-form-number">Numri i Llogaris√´:</label>
                        <input type="text" id="account-form-number" name="accountNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="account-form-type">Tipi i Llogaris√´:</label>
                        <select id="account-form-type" name="accountType" required class="form-control"></select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="account-form-name">Emri i Llogaris√´:</label>
                    <input type="text" id="account-form-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="account-form-description">P√´rshkrimi (Opsional):</label>
                    <textarea id="account-form-description" name="description" rows="2"></textarea>
                </div>
                <div class="form-group checkbox-label-inline">
                    <input type="checkbox" id="account-form-is-system" name="isSystemAccount">
                    <label for="account-form-is-system">Llogari Sistemi (E mbrojtur)</label>
                </div>
                <p id="account-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Ruaj Llogarin√´</button>
                    <button type="button" id="cancel-account-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Journal Entry Form Modal -->
    <div id="journal-entry-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="journal-entry-form-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="journal-entry-form-modal-title">Shto Veprim t√´ Ri Kontab√´l</h2>
            <form id="journal-entry-form">
                <input type="hidden" id="edit-journal-entry-id" name="editJournalEntryId">
                <div class="form-grid-2-cols" style="margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label for="journal-entry-date">Data:</label>
                        <input type="date" id="journal-entry-date" name="date" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="journal-entry-description">P√´rshkrimi i Veprimit:</label>
                        <input type="text" id="journal-entry-description" name="description" required class="form-control">
                    </div>
                </div>

                <h3 class="modal-section-title">Rreshtat e Veprimit</h3>
                <div class="table-responsive" style="max-height: 40vh;">
                    <table class="admin-table items-table" id="journal-entry-lines-table">
                        <thead>
                            <tr>
                                <th>Llogaria Kontab√´l</th>
                                <th>P√´rshkrimi (Opsional)</th>
                                <th class="text-right">Debi (‚Ç¨)</th>
                                <th class="text-right">Kredi (‚Ç¨)</th>
                                <th>Veprim</th>
                            </tr>
                        </thead>
                        <tbody id="journal-entry-lines-tbody">
                            <!-- Populated by JS -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="2" class="text-right"><strong>Totali:</strong></td>
                                <td class="text-right" id="journal-entry-debit-total"><strong>0.00 ‚Ç¨</strong></td>
                                <td class="text-right" id="journal-entry-credit-total"><strong>0.00 ‚Ç¨</strong></td>
                                <td id="journal-entry-balance-status"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <button type="button" id="add-journal-entry-line-btn" class="btn btn-secondary btn-sm" style="margin-top: 1rem;">+ Shto Rresht</button>

                <p id="journal-entry-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-journal-entry-btn" class="btn btn-primary">Ruaj Veprimin</button>
                    <button type="button" id="cancel-journal-entry-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Production Module Modals -->
    <div id="recipe-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="recipe-form-modal-close-btn">&times;</span>
            <h2 id="recipe-form-modal-title">Shto Recet√´ t√´ Re</h2>
            <form id="recipe-form">
                <input type="hidden" id="edit-recipe-id">
                <div class="form-grid-2-cols">
                    <div class="form-group">
                        <label for="recipe-name-input">Emri i Recet√´s:</label>
                        <input type="text" id="recipe-name-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="recipe-final-product-select">Produkti Final:</label>
                        <select id="recipe-final-product-select" class="form-control" required></select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="recipe-notes-textarea">Sh√´nime (Opsionale):</label>
                    <textarea id="recipe-notes-textarea" class="form-control" rows="2"></textarea>
                </div>
                <h3 class="modal-section-title">P√´rb√´r√´sit (Materialet e Para)</h3>
                <div class="item-entry-grid" style="grid-template-columns: 3fr 1fr 1fr auto;">
                    <div class="form-group">
                        <label for="recipe-ingredient-select">Zgjidh P√´rb√´r√´sin:</label>
                        <select id="recipe-ingredient-select" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label for="recipe-ingredient-quantity">Sasia:</label>
                        <input type="number" id="recipe-ingredient-quantity" class="form-control text-right" min="0.001" step="any">
                    </div>
                     <div class="form-group">
                        <label for="recipe-ingredient-unit">Nj√´sia:</label>
                        <input type="text" id="recipe-ingredient-unit" class="form-control readonly-field" readonly>
                    </div>
                    <div class="lp-item-actions">
                         <button type="button" id="add-ingredient-to-recipe-btn" class="btn btn-info">Shto</button>
                    </div>
                </div>
                <div class="table-responsive" style="max-height: 250px; margin-top: 1rem;">
                    <table class="admin-table items-table">
                        <thead>
                            <tr><th>Kodi</th><th>P√´rb√´r√´si</th><th class="text-right">Sasia e Nevojshme</th><th>Nj√´sia</th><th>Veprim</th></tr>
                        </thead>
                        <tbody id="recipe-ingredients-tbody"></tbody>
                    </table>
                </div>
                <p id="recipe-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-recipe-btn" class="btn btn-primary">Ruaj Recet√´n</button>
                    <button type="button" id="cancel-recipe-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <div id="production-order-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="production-order-form-modal-close-btn">&times;</span>
            <h2 id="production-order-form-modal-title">Krijo Urdh√´r Prodhimi</h2>
            <form id="production-order-form">
                <input type="hidden" id="edit-production-order-id">
                <div class="form-group">
                    <label for="production-order-recipe-select">Zgjidh Recet√´n:</label>
                    <select id="production-order-recipe-select" class="form-control" required></select>
                </div>
                <div class="form-group">
                    <label for="production-order-quantity">Sasia p√´r Prodhim:</label>
                    <input type="number" id="production-order-quantity" class="form-control" min="1" step="1" required>
                </div>
                <div class="form-group">
                    <label for="production-order-lost-quantity">Sasia e Humbur (Opsionale):</label>
                    <input type="number" id="production-order-lost-quantity" class="form-control" min="0" step="any" placeholder="0">
                </div>
                <div class="form-group">
                    <label for="production-order-date">Data e Urdh√´rit:</label>
                    <input type="date" id="production-order-date" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="production-order-due-date">Data e P√´rfundimit (Opsionale):</label>
                    <input type="date" id="production-order-due-date" class="form-control">
                </div>
                <div id="production-order-materials-preview" class="info-message secondary" style="display: none;"></div>
                <p id="production-order-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-production-order-btn" class="btn btn-primary">Krijo Urdh√´rin</button>
                    <button type="button" id="cancel-production-order-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="production-stage-form-modal" class="modal" style="display: none;">
        <div class="modal-content medium-modal-content">
            <span class="close-button" id="production-stage-form-modal-close-btn">&times;</span>
            <h2 id="production-stage-form-modal-title">Shto Faz√´ t√´ Re Prodhimi</h2>
            <form id="production-stage-form">
                <input type="hidden" id="edit-production-stage-id">
                <div class="form-group">
                    <label for="production-stage-name-input">Emri i Faz√´s:</label>
                    <input type="text" id="production-stage-name-input" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="production-stage-description-input">P√´rshkrimi (Opsional):</label>
                    <textarea id="production-stage-description-input" class="form-control" rows="3"></textarea>
                </div>
                <p id="production-stage-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-production-stage-btn" class="btn btn-primary">Ruaj Faz√´n</button>
                    <button type="button" id="cancel-production-stage-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>

    <div id="production-routing-form-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="production-routing-form-modal-close-btn">&times;</span>
            <h2 id="production-routing-form-modal-title">Shto Proces t√´ Ri Teknologjik</h2>
            <form id="production-routing-form">
                <input type="hidden" id="edit-production-routing-id">
                <div class="form-group">
                    <label for="production-routing-name-input">Emri i Procesit:</label>
                    <input type="text" id="production-routing-name-input" class="form-control" required>
                </div>
                <div class="form-group">
                    <h3>Zgjidh Hapat e Prodhimit (me Rradh√´)</h3>
                    <div id="production-routing-stages-list" class="permissions-group" style="max-height: 250px; overflow-y: auto;">
                        <p class="info-message">Nuk ka faza prodhimi t√´ definuara.</p>
                    </div>
                </div>
                <p id="production-routing-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-production-routing-btn" class="btn btn-primary">Ruaj Procesin</button>
                    <button type="button" id="cancel-production-routing-form-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Generic Confirm/Alert Modal -->
    <div id="custom-confirm-modal" class="modal" style="display: none;">
        <div class="modal-content small-modal-content">
            <span class="close-button" id="custom-confirm-modal-close-btn">&times;</span>
            <p id="custom-confirm-message">Mesazh Konfirmimi</p>
            <div class="modal-actions">
                <button id="custom-confirm-btn" class="btn btn-primary">OK</button>
                <button id="custom-cancel-confirm-btn" class="btn btn-secondary" style="display: none;">Anulo</button>
            </div>
        </div>
    </div>
    
    <!-- Print Preview Modal -->
    <div id="print-preview-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="print-preview-modal-close-btn">&times;</span>
            <h2 id="print-preview-modal-title">Pamje Paraprake</h2>
            <div id="print-preview-content" class="printable-area">
                <!-- Content to be printed will be injected here -->
            </div>
            <div class="modal-actions no-print">
                <button id="actual-print-from-preview-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp</button>
                <button id="cancel-print-preview-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>

    <!-- Payslip Details Modal -->
    <div id="payslip-details-modal" class="modal no-print" style="display: none;">
        <div class="modal-content large-modal-content">
            <span class="close-button" id="payslip-details-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2 id="payslip-details-modal-title">Detajet e Flet√´pages√´s</h2>
            <div id="payslip-details-printable-content" class="printable-area">
                <!-- Content will be populated by JS -->
            </div>
            <div class="modal-actions">
                <button type="button" id="payslip-details-print-btn" class="btn btn-primary"><span class="icon">üñ®Ô∏è</span> Shtyp Flet√´pages√´n</button>
                <button type="button" id="payslip-details-close-action-btn" class="btn btn-secondary">Mbyll</button>
            </div>
        </div>
    </div>

    <!-- Petty Cash Modal (New) -->
    <div id="petty-cash-modal" class="modal" style="display: none;">
        <div class="modal-content small-modal-content">
            <span class="close-button" id="petty-cash-modal-close-btn" aria-label="Mbyll">&times;</span>
            <h2>Regjistrim i Shpenzimit t√´ Vog√´l (Petty Cash)</h2>
            <form id="petty-cash-form">
                <div class="form-group">
                    <label for="petty-cash-description">P√´rshkrimi:</label>
                    <textarea id="petty-cash-description" name="description" class="form-control" rows="3" required placeholder="P.sh., Blerje letre, kafe, etj."></textarea>
                </div>
                <div class="form-group">
                    <label for="petty-cash-amount">Shuma (‚Ç¨):</label>
                    <input type="number" id="petty-cash-amount" name="amount" min="0.01" step="any" class="form-control" required placeholder="0.00">
                </div>
                <p id="petty-cash-form-error" class="error-message" aria-live="polite"></p>
                <div class="modal-actions">
                    <button type="submit" id="save-petty-cash-btn" class="btn btn-primary">Ruaj Shpenzimin</button>
                    <button type="button" id="cancel-petty-cash-btn" class="btn btn-secondary">Anulo</button>
                </div>
            </form>
        </div>
    </div>


    <script type="module" src="/index.tsx"></script>
</body>
</html>
